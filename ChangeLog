Fri Dec  6 08:16:28 1996  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* src/gate/rfc2ftn.c (rfc_parse): if node==NULL return OK after
	  MAUS parsing.
	  (mail_receiver): call rfc_parse() with gw==FALSE for EchoMail.

	* test/tc.gate7/run: added EchoMail tests with Gateway
 	  242:4900/99.

	* test/tc.gate7/config: added local config file setting Gateway
	  address. 

	* test/tc.gate7/run: added test with X-Comment-To: ().

Tue Dec  3 21:22:34 1996  Martin Junius  <mj@fido.de>

	======= Release 4.1.3 ================================================
	------- CVS ci, tag R413 ---------------------------------------------

	* examples/morannon/config.common: same.

	* examples/orodruin/config.common: added PInbound, UUInbound.

	* fidogate.lsm: updated.

	* README: updated.

	* ANNOUNCE (Subject): updated for new release.

Mon Dec  2 20:04:10 1996  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* doc/fidogate.texi (config.h): updated, DEF_HISTORY.
	  (Config): added History.

	* examples/orodruin/config.common: added History to example.

	* src/toss/history.c (hi_init): use new cf_p_history().

	* src/toss/ftnexpire.c (do_expire): use new cf_p_history() to get
	  complete history database file name.

	* src/include/prototypes.h (BUF_EXPAND): new wrapper for
	  str_expand_name(). 

	* src/common/config.c (cf_p_history): new function retrieving
	  History value from config file (default DEF_HISTORY).

	* config.h (DEF_HISTORY): old HISTORY changed to new default
	  value. Can be overwritten with History in config file.

	* src/toss/ftnexpire.c (do_expire): use dbzagain() to initialize
	  new history database. This should solve the performance problem.

Sun Dec  1 11:29:54 1996  Martin Junius  <mj@fido.de>

	* test/tc.history/rndmsgid: script for random msgid generation.

	* src/toss/history.c (main): new -t TIME option.
	  (hi_write_t): modified low-level version of hi_write(), taking
	  additional time of entry in history database.
	  (hi_write): use new hi_write_t().
	  (main): if no msgid on command line, read from stdin.

	* test/tc.history/run: new test case for history database.

	* src/toss/history.c (main): changed printf()s to debug().

	------- CVS ci -------------------------------------------------------

	* src/common/routing.c (parse_pkt_name): added sanity check for
	  grade/type/flavor taken from packet file name. If type or flavor
	  is invalid use default -/-/Normal.

	* src/common/binkley.c (flav_to_asc): return "Normal" for unknown
	  flavor code.

	* doc/fidogate.texi (ftnpack): added -F / and appropriate
	  warning.

Sat Nov 30 14:35:27 1996  Martin Junius  <mj@fido.de>

	* src/toss/ftnpack.c (do_noarc): call bink_attach() with mode==0,
	  not trying to delete the attachment.

	------- CVS ci -------------------------------------------------------

	* src/toss/runtoss.sh: outf uses FADIR=-F/

	* src/toss/ftnpack.c (do_noarc): if -F / is specified, treat file
	  attachment in subject as complete path, don't use
	  dir_search().

	------- CVS ci -------------------------------------------------------

	* config.h (FTN_RFC_HEADERS): added "Sender" to list of recognized
	  RFC headers.

	* test/tc.gate10/run: new test case, Sender for mailing lists.

	* src/gate/rfc2ftn.c (snd_message): add Sender line, if RFC
	  headers Sender or Resent-From are present. Typically, this will
	  be the case with mailing lists.

	* scripts/run/runpoll.sh: use runtoss outf.

	* src/toss/runtoss.sh: added new toss name "outf", running the
	  tosser for the rfc2ftn outbound with file attachments.

	* src/toss/runin.sh: add $$ to ftnlock command line.

	------- CVS ci -------------------------------------------------------

	* config.h (RFC_LVL_1_HEADERS): added "Sender", "Resent-From".

	* src/common/lock.c: all debug() levels set to 7.

	* doc/fidogate.texi (ftnlock): updated.

	* src/util/ftnlock.c (usage): new option -w --wait, new optional
	  parameter id.
	  (main): implemented new option -w --wait, use new
	  lock_program_id() with optional command line parameter id. This
	  allow scripts using the ftnlock utility to write the script PID
	  to the lock file, not the PID of the called ftnlock, e.g. by
	  executing ftnlock abcd $$.

	* src/common/lock.c (lock_lockfile_id): new version of old
	  lock_lockfile() function, using new id argument. If id!=NULL,
	  this string will be put into the lockfiles, else the PID.
	  (lock_lockfile): use new lock_lockfile_id() with id==NULL.
	  (lock_program_id): new variant of lock_program(), passing new
	  arg id to lock_lockfile_id().
	  (lock_program): use lock_lockfile_id() wiht id==NULL.

Fri Nov 29 22:17:54 1996  Martin Junius  <mj@fido.de>

	* src/toss/rununpack.sh (SPOOL): fixed to use same var name as
	  runtoss.

	------- CVS ci -------------------------------------------------------

	* examples/morannon, orodruin: updated example config files.
	
	* version.h (PATCHLEVEL): set to 3.

Mon Nov 25 19:34:09 1996  Martin Junius  <mj@fido.de>

	* src/gate/ftn2rfc.c (get_from): try to parse ^AREPLYADDR as an
	  FTN address. If it is an FTN address, don't return as Internet
	  address. 

	------- CVS ci -------------------------------------------------------

	* src/toss/runout.sh (LOGDIR): use ftnconfig.

	* src/toss/runin.sh (LOGDIR): use ftnconfig.

	* src/util/ftnconfig.c (do_para): added =inbound, =pinbound,
	  =uuinbound, =outbound to fixed parameters.

	* src/toss/rununpack.sh: same.

	* src/toss/runtoss.sh (SPOOL, OUTBOUND, INBOUND, PINBOUND,
	  UUINBOUND): use ftnconfig to get values.

	* src/util/ftnconfig.c (do_para): added =libdir, =spooldir,
	  =logdir to list of fixed parameters.

	* src/common/config.c (cf_origin, cf_organzation, cf_set_outbound,
	  cf_outbound, cf_set_inbound, cf_inbound)): removed.
	  (cf_do_line): removed special treatment for Origin,
	  Organization, Inbound, Outbound parameters (are now normal
	  string parameters).

	* src/include/prototypes.h
	  (cf_set_outbound): #define'd to cf_s_outbound(). 
	  (cf_outbound): #define'd to cf_p_outbound().
	  (cf_set_inbound): #define'd to cf_s_pinbound().
	  (cf_inbound): #define'd to cf_p_pinbound().
	  (cf_origin): #define'd to cf_p_origin().
	  (cf_organization): #define'd to cf_p_organization().

	* src/common/config.c (cf_p_s_pinbound): new version of old
	  cf_p_inbound(), allowing to set pval.
	  (cf_p_pinbound): use new cf_p_s_pinbound().
	  (cf_s_pinbound): new function setting PInbound value.
	  (cf_p_s_outbound): new function get/set Outbound value.
	  (cf_p_outbound): get Outbound parameter value.
	  (cf_s_outbound): set Outbound parameter value.
	  (cf_p_organization): new function get Organization parameter value.
	  (cf_p_origin): new function get Origin parameter value.

Sun Nov 17 12:47:41 1996  Martin Junius  <mj@fido.de>

	======= Release 4.1.2 ================================================
	------- CVS ci, tag R412 ---------------------------------------------

	* fidogate.lsm: updated.

	* ANNOUNCE: updated.

	* src/gate/ftn2rfc.c (unpack): initialize cvt8=0 for NetMail.
	  (unpack_file): remove debug() message, same as log().

	* src/common/kludge.c (kludge_getn): modified version of old
	  kludge_get() with new arg first. first==TRUE gets first kludge
	  from list, first==FALSE gets next one.
	  (kludge_get): use kludge_getn() with first==TRUE.

	* src/gate/ftn2rfc.c (unpack): don't delete when calling
	  kludge_pt_intl(). 

Wed Nov 13 22:14:55 1996  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* version.h (PATCHLEVEL): set to 2.

	* src/common/message.c (msg_xlate_line): must translate '=' to
	  '=3D' if using the MIME quoted-printable encoding.
	  (msg_xlate_line): AREA_QP has priority over AREA_8BIT.

	* test/tc.8bit/run: added another test mail, body2.

Sun Nov 10 11:37:44 1996  Martin Junius  <mj@fido.de>

	* src/toss/ftntoss.c (do_echomail): changed format of dupe log()
	  messages. 

	* ANNOUNCE, fidogate.lsm: updated file size.

	======= Release 4.1.1 ================================================
	------- CVS ci, tag R411 ---------------------------------------------

	* sendmail/cf/: rebuild .cf files.

	* mksubst.pl: removed.

	* README: updated.

	* fidogate.lsm: updated.

	* ANNOUNCE: updated for release 4.1.1

Sat Nov  9 17:26:07 1996  Martin Junius  <mj@fido.de>

	* src/toss/ftnaf.c (do_mail): ignore stuff aftern "-- " line
	  (start of signature).

	* src/toss/ftnafmail.c (main): initialize filefix = FALSE.

	* src/gate/ftninpost.pl: check that FTNInSendmail and FTNInRnews
	  is specified in config.gate.

	------- CVS ci -------------------------------------------------------

	* doc/fidogate.texi (Programs): added ftnafmail.
	  (ftnafmail): new node describing new ftnafmail program.

	* src/util/pktdebug.c (main): call kludge_pt_intl() to retrieve
	  complete address information.

	* src/toss/ftntoss.c (unpack): same.

	* src/toss/ftnroute.c (do_packet): same, removed #if 0 code.

	* src/toss/ftn2ftn.c (unpack): same.

	* src/gate/ftn2rfc.c (unpack): changed call to kludge_pt_intl().

	* src/common/kludge.c (kludge_pt_intl): new arg del, only call
	  tl_delete() if del == TRUE.
	  (kludge_pt_intl): strsave() ^AINTL line before running strtok().

	* src/gate/rfc2ftn.c (sendback): added va_end().

	* src/common/textlist.c (tl_appendf): added va_end().

	* src/common/log.c (log): added call to va_end().
	  (debug): error message, no output if no_debug == TRUE. Added
	  call to va_end().

	* src/common/config.c (cf_initialize): check for real uid !=
	  effective uid (setuid installed FIDOGATE programs) and set
	  no_debug=TRUE in this case.

	* src/toss/Makefile (install): install ftnaf as normal binary,
	  ftnafmail as setuid.

	* src/toss/ftnafmail.c: new setuid wrapper for ftnaf. Used for
	  sending mail to Areafix/Filefix.

	* src/toss/ftnaf.c (main): removed -x --exec-program option,
	  security problems.
	  (run_script): removed.
	  (cmd_add): removed call to run_script().

Fri Nov  1 13:25:29 1996  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* doc/fidogate.texi (Example Point): added that EchoMail4D is
	  reqired.

	* src/toss/ftntoss.c (do_echomail): moved tl_clear() for SEEN-BY,
	  PATH after path check, so that bad messages still contain the
	  original SEEN-BYs and PATH.

	* sendmail/mailer/ftn.m4: mailer ftna runs
	      rfc2ftn -a $h -u $h -O %S/out/$h 
	  writing output packets in a separate directory. This requires
	  running the tosser afterwards because from/to addresses of the
	  packet are the same ($h).
    	
	* src/gate/ftn2rfc.c (main): use str_expand_name() for -I.

	* src/toss/ftnpack.c (main): same + use BUF_COPY3(), also for -O.

	* src/toss/ftnroute.c (main): same + use BUF_COPY3().

	* src/toss/ftntoss.c (main): use str_expand_name() for -I.

	* src/common/packet.c (pkt_outdir): use str_expand_name(), so that
	  %S/%L/%O can be used.
	  (pkt_baddir): same.

	* src/toss/runtoss.sh: added -p for "runtoss out".

	* doc/fidogate.texi (ftntoss): added -p --passthru option.

	* src/toss/ftntoss.c (usage): new -p --passthru option.
	  (main): implemented -p --passthru.
	  (do_echomail): only toss for own address if p_flag is FALSE.

	* doc/fidogate.texi (Example Point 2): new section for setup with
	  2 point addresses. Not yet complete.

	------- CVS ci -------------------------------------------------------

	* src/gate/rfc2ftn.c (rfc_parse): new argument gw, if TRUE enables
	  cf_gateway() checking and address/name replacement.
	  (mail_receiver): call rfc_parse() with gw=TRUE.
	  (mail_sender): call rfc_parse() with gw=FALSE, fixing the bug
	  that also the sender was set to UUCP when Gateway Z:N/F.P was
	  enabled in config.gate.

	* test/tc.gate9/run (Subject): new test case for "Gateway" config
	  statement. 

Mon Oct 28 22:04:56 1996  Martin Junius  <mj@fido.de>

	* test/tc.point2/run: new test case to setup with 2 different
	  point addresses and 2 different uplinks.

Sun Oct 27 13:33:33 1996  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* test/tc.8bit/run: new test case for testing char conversion
 	  quoted-printable -> rfc2ftn -> ftn2rfc ->
 	  ascii/8bit/quoted-printable.

	* src/common/charset.c (xtab[][][]): improved ISO LATIN-1 ->
	  ASCII/8BIT/QP conversion table.

	* src/toss/rununpack.sh: check that an archiver program for the
	  archiver type was found.

	* src/common/config.c (cf_p_aliases, areas, hosts, passwd,
	  packing, routing): char buf[] replaced with
	  char *pval.
	  (cf_p_inbound): new function returning config Inbound.
	  (cf_p_pinbound): new function returning config PInbound,
	  fallback is Inbound.
	  (cf_p_uuinbound): new function returning config UUInbound,
	  fallback is Inbound.

	* doc/fidogate.texi (Areas): added -Q.
	  (Config): added NetMail8bit, NetMailQuotedPrintable.
	  (Config): changed Inbound, PInbound, added UUInbound.

	* config.h (CHARSET_8BIT): removed.

Tue Oct 22 20:52:14 1996  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* src/common/rfcaddr.c (rfcaddr_from_ftn): call charset_xlate()
	  with cidx=0.

	* src/common/charset.c (charset_xlate): additional arg cidx, used
	  as index for xtab[][][].

	* src/common/message.c (msg_xlate_line): call charset_xlate() with
	  new arg cidx.

	* src/common/charset.c (xtab): extended to 3d array, left index is
	  type of conversion 0=US-ASCII, 1=ISO-8859-1 8BIT, 2=ISO-8859-1 QP.

	* src/common/message.c (msg_xlate_line): new cvt8 argument.

	* src/gate/ftn2rfc.c (news_msg): initialize all Area fields.
	  (netmail_8bit, netmail_qp): new flags for config.gate
	  "NetMail8bit", "NetMailQuotedPrintable".
	  (main): get "NetMail8bit", "NetMailQuotedPrintable" from config.gate.
	  (unpack): output MIME-Version, Content-Type,
	  Content-Transfer-Encoding headers dependend on cvt8 flag
	  settings (AREA_8BIT | AREA_QP).
	  (unpack): moved check for mail or news before message body
	  conversion (must set cvt8 before).
	  (unpack): pass cvt8 / 0 as additional parameter to msg_xlate_line().

	* src/common/areas.c (areas_init): implemented -Q option.

	* src/include/structs.h (AREA_QP): new #define for -Q option.

Sun Oct 20 10:53:14 1996  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* test/tc.gate6/run: added test with a large mail message >660K to
	  test for correct computation of number of split messages.

	* version.h (PATCHLEVEL): set to 1.

	* src/gate/rfc2ftn.c (snd_mail): initialize from_is_local = FALSE.
	  (snd_message): run same algorithm to compute number of parts as
	  done for the actual splitting.

	* src/common/address.c (addr_is_domain): moved debug() after var
	  settings. 

	* src/ffx/ffxrmail.pl: if the From_ line does not contain an
	  envelope sender, set to news@localhost.

	* doc/fidogate.texi (ftnpack): added -F --file-dir option.

	======================================================================

	* Started new ChangeLog after release of 4.1.0, old ChangeLog
	  renamed to ChangeLog.O.

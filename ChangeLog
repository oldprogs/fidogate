Sun Apr 27 09:56:05 1997  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* ANNOUNCE: updated.

	* src/common/log.c (strerror): added new #ifndef __FreeBSD__ for
	  sys_errlist[] declaration.

	* config.h: added new #ifdef __FreeBSD__ section.

	* config.make (INSTALL_*): added -c to make old BSD install happy.

	* src/toss/ftntoss.c (do_echomail): add message sender/recipient
	  to SEEN-BY if not already there. Hopefully avoids problems with
	  EchoMail if sender doesn't do SEEN-BYs as we expect them.
	  (do_echomail): message from current AKA is not insecure.

	* version.h (PATCHLEVEL): set to 2 (version 4.2.2).

	* ANNOUNCE: "Changes in ..." moved to README.

Sat Apr 19 10:38:58 1997  Martin Junius  <mj@fido.de>

	* doc/fidogate.texi (Example Point 2): areas.bbs must have an
	  entry in the 1st col.

	* Makefile (install): install ANNOUNCE into HTMLDIR.

	======= Release 4.2.1 ================================================
	------- CVS ci, tag R421 ---------------------------------------------

	* scripts/maintenance/logmaint.sh: complete rewrite using
	  functions from newsyslog.sh.

	* ANNOUNCE: updated.

	* fidogate.lsm: updated.

	* src/toss/rununpack.sh: yet another fix to the rename loop.

Fri Apr 18 15:14:04 1997  Martin Junius  <mj@fido.de>

	* src/toss/rununpack.sh: fixed rename loop, remove unpack.out.

	* src/gate/rfc2ftn.c (snd_message): don't print_local_msgid(), if
	  msgid_rfc_to_fido() returns NULL.

	* test/tc.nomsgid/run: new test case for Message-ID: <NOMSGID_...>.

	------- CVS ci -------------------------------------------------------

	* doc/fidogate.texi (Programs): added %X.
	  (Config files): added %X.
	  (ftnpack): added -f --ffx.
	  (Config): added LimitMsgSize.
	  (Areas): added -L.
	  (config.h): added DO_HAVE_SYSEXITS_H.
	  (Usage): added new usage chapter.
	  (RFC Headers in FTN Messages): added new section documenting the
 	  RFC header in FTN messages.
	  (X Headers in RFC Messages): added new section documenting the
	  X-Comment-To and X-Flags headers.

	* src/util/ftnflo.c (do_flo): use new run_system().

	* src/toss/ftnpack.c (do_arcmail): use new run_system().
	  (do_prog): use new run_system().

	* src/gate/ftn2rfc.c (main): use new run_system().

	* src/ffx/ffxqt.c (exec_ffx): use new run_system().

	* src/ffx/ffx.c (ffx): use new run_system().

	* src/ffx/ffxbatch.c (pack_batch): use new run_system().

	* src/gate/ftnin.c (do_packets): used new run_system().
	  (exec_ftn2rfc): use new run_system().

	* src/common/misc.c (run_system): new wrapper function for
	  system(), runs DOSIFY_IF_NEEDED and extract exit code.

	* src/include/prototypes.h (DOSIFY_IF_NEEDED): new macro
	  translates to str_dosify() only if MSDOS or OS2 are defined.

	* src/gate/ftnin.c (main): removed MSDOS/OS2 code for cmd[], will
	  be handled by str_dosify() before running system().

	------- CVS ci -------------------------------------------------------

	* sendmail/README.FIDOGATE: updated.

	* sendmail/: updated config files to sendmail-cf 8.8.5, rebuild
	  sample .cf files.

	* src/gate/ftn2rfc.c (check_valid_domain): new function checking
	  for valid Internet domain name string, [a-zA-Z0-9.-]+.
	  (unpack): if address in the FTN to field are allowed, check for
	  user@do.main or user%do.main with a valid Internet domain
	  address and put into mail_to[]. Avoids "..." around the address.
	  Several strncpy()'s replaced with BUF_COPY().

	* src/toss/rununpack.sh: move all files in tmp directory to ..,
	  not just *.pkt's. Rename file from ArcMail packet to <1..n>file,
	  if it already exists in the inbound directory.

Sat Apr 12 09:22:58 1997  Martin Junius  <mj@fido.de>

	* scripts/run/run2.sh: some changes.

	* scripts/run/run1.sh: some changes.

	* config.make (IFMAILDIR): added ifmail directory.

	------- CVS ci -------------------------------------------------------

	* scripts/inn/viaffx: use $batch on ffx command line, set to "-b $1".

	* scripts/run/runpoll: using new send-ffx-b, ffxbatch replaced
	  with ftnpack -f.

	* src/toss/ftnpack.c (main): if ffx_flag, using directory pattern
	  "f???????*".

	* test/tc.ffx/ffxmail: special ffxmail for test case.

	* test/tc.ffx/run: new test case, testing ffx + new ftnpack -f.

	* src/toss/ftnpack.c (main): if ffx_flag is set, create/delete BSY
	  file for address ffx_node (option -f --ffx Z:N/F.P).
	  (do_file): if ffx_flag, set packet from/to = AKA/ffx_node,
	  pkt_file = NULL.
	  (main): create lock/BSY file *before* reading directory.
	  (do_dirpack): if ffx_flag, don't create/delete BSY file.
	  (do_pack): only create/delete BSY file for arcnode, if ffx_flag
	  is not set or arcnode != ffx_node.
	  (do_pack): if ffx_flag, always use do_arcmail().
	  (do_pack): only fclose(file), if file != NULL.
	  (do_arcmail): only rename/copy packet file, if not ffx_flag.

	* src/ffx/ffxbatch.c (main): use EXIT_xxxx codes.

	* src/toss/ftnpack.c (main): use BUF_EXPAND(), BUF_COPY().
	  (main): added Z:N/F.P address argument to -f --ffx.

	* examples/orodruin/config.common: added %X description.

	* src/common/misc.c (str_expand_name): now %G = LogDir, added %O =
	  Outbound, %I = Inbound, %P = PInbound, %U = UUInbound.

	* src/toss/ftnpack.c (usage): new option -f --ffx.
	  (main): new option -f --ffx, sets ffx_flag.

	------- CVS ci -------------------------------------------------------

	* version.h (PATCHLEVEL): set to 1 (version 4.2.1).

	* src/common/misc.c (str_dosify): new function converting string
	  with filename from UNIX `/' to MSDOS `\'.

	* src/common/binkley.c (bink_out_name): implemented
	  AMIGADOS_4D_OUTBOUND. 

	* src/toss/ftnpack.c (arcmail_name): implemented
	  AMIGADOS_4D_OUTBOUND. 

	* config.h (AMIGADOS_4D_OUTBOUND): new #define to enable
	  4D outbound filenames for AmigaDOS mailers, Z.N.F.P.flo /
	  Z.N.F.P.mo0. Patches supplied by James McOrmond <jam@jammys.net>.

Thu Apr 10 20:52:03 1997  Martin Junius  <mj@fido.de>

	* config.h (FTN_RFC_HEADERS): added ":" to last two strings.

	* examples/orodruin/hosts: updated.

	* examples/morannon/routing: updated.

	* examples/morannon/hosts: updated.

	* examples/morannon/aliases: updated, Fido.DE user aliases
	  removed.
	
	* ANNOUNCE: updated.

	* fidogate.lsm: updated.

	* test/tc.gate6/run: added exit 0 to continue in make check.

	======= Release 4.2.0 ================================================

	* Intermediate release for installing at morannon.fido.de, not
	  entirely suitable for public release.

	------- CVS ci, tag R420 ---------------------------------------------

Sun Mar 30 16:45:38 1997  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* src/gate/ftn2rfc.c (unpack): if no 8bit characters are found in
	  the message body, don't use ISO-8859-1/8BIT either.

	* examples/morannon/: update of configuration files.

	------- CVS ci -------------------------------------------------------

	* src/toss/ftntoss.c (main): for statistics, the minimum time is
	  1s for the tosser run to avoid division by 0 errors.

	* src/util/pktdebug.c (main): implemented new -s --short
	  option. The new short format display only the filename, the
	  packet sender/recipient, and the number of NetMail/EchoMail
	  messages in the packet.

	* test/tc.boss/run: new test case, boss node tosser processing
	  EchoMail from/to points.

	------- CVS ci -------------------------------------------------------

	* examples/README: added new example dirs.

	* examples/namib.north.de: same.

	* examples/abis.abra.de: added new example configuration directory
	  from Andreas Braukmann's <andy@Abra.DE> fgate.tgz package.

Sat Mar 29 20:43:04 1997  Martin Junius  <mj@fido.de>

	* src/tick/ftntick.c (process_tic): no error if unlink(old_name)
	  fails, the file to be replaced may not exist.

Fri Mar 28 10:48:20 1997  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* src/common/areas.c (area_build): copy limitsize.

	* test/tc.gate6/run: added test with config2, setting LimitMsgSize.

	* examples/orodruin/config.gate: added LimitMsgSize example.

	* examples/orodruin/areas: added -L to description in comment.

	* examples/orodruin/config.gate: added LimitMsgSize example.

	* src/include/sysexits.h: removed, #define's move to fidogate.h.

	* src/include/fidogate.h (EX_*): if DO_HAVE_SYSEXITS_H is defined
	  use sysexits.h system header file, else use the local
	  definitions here.

	* src/gate/rfc2ftn.c (main): new LimitMsgSize config option.
	  (print_origin): use BUF_COPY(), str_append(), BUF_APPEND().
	  (snd_mail): check message size against limit, bounce/don't gate
	  if limit is exceeded.

	* src/common/areas.c (areas_init): added code for -L LIMITSIZE
	  option, use atol() for long values.
	  (areas_limitmsgsize): new function to set default limitmsgsize.
	  (areas_get_limitmsgsize): new function to get default limitmsgsize.

	* src/include/structs.h (Area): added limitsize field for -L option.

Wed Mar 26 21:26:18 1997  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* src/gate/ftn2rfc.c (unpack): only set cc_line, bcc_line, if
	  there is a To: line in the message body. Avoids problems with
	  Fido type CC: lines.
	  (check_8bit): new function checking for 8bit characters in Textlist.
	  (unpack): check for 8bit characters in message body. If none are
	  found, don't use the quoted-printable encoding.

	------- CVS ci -------------------------------------------------------

	* src/gate/ftn2rfc.c (unpack): check for Content-Transfer-Encoding
	  in RFC headers or ^ARFC kludges and set cvt8 flag accordingly.

	* config.h (FTN_RFC_HEADERS): added Content-Transfer-Encoding.

	* scripts/maintenance/newsyslog.sh: rewrite, first rename log
	  files, then restart the daemons, then compress the old log
	  files. In particular crond doesn't like its log file being
	  compressed while still opened by crond.

Sun Mar 23 10:24:56 1997  Martin Junius  <mj@fido.de>

	* src/tick/ftntick.c (process_tic): Replaces handling done before
	  moving new file from inbound to file area. Avoids deleting the
	  new file, if the file name and Replaces name are the same.
	  (move): added log() for copy_file() errors.
	  (process_tic): added log() for Replaces handling errors.
	  (process_tic): added log() for Replaces operation.

	* src/common/tick.c (tick_get): use lon_add_string(), SeenBy may
	  contain more than one FTN address.

Sun Feb 23 11:53:39 1997  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* src/common/message.c (msg_body_parse_echomail): missing PATH
	  line is not an error.

	* examples/orodruin/config.main: added EchoMail4D, NoEmptyPath
	  examples. 

	* test/tc.toss1/config2: test config with KillOld.

	* test/tc.toss1/config1: test config with EchoMail4D, NoEmptyPath.

	* test/tc.toss1/run: added test run with EchoMail4D setting.

	* src/toss/ftntoss.c (node_eq3d): renamed to node_eq_echo().
	  (node_eq3da): renamed to node_eq_echo().
	  (lon_search3d): renamed to lon_search_echo_pa().
	  (main): added NoEmptyPath config option.
	  (lon_to_kludge): if echomail4d is TRUE, don't strip point addresses.
	  (lon_to_kludge_sorted): same.
	  (lon_to_kludge): return number of entries in output.
	  (lon_to_kludge_sorted): same.
	  (addtoseenby_init): replaced strncpy0()/strncat0() with
	  BUF_COPY()/BUF_APPEND().
	  (lon_to_kludge): same.
	  (lon_to_kludge_sorted): same.
	  (do_echomail): if no_empty_path is TRUE and number of entries is
	  PATH is 0 (stripped because it's a point address) then don't
	  create an empty PATH line.

	* doc/fidogate.texi (Config): added EchoMail4D.

	* src/toss/ftntoss.c (seenby_eq): renamed to node_eq3d().
	  (node_eq2d): new function, compare node ignoring zone and point.
	  (seenby_search): renamed to lon_search3d().
	  (do_echomail): call do_4point(), replacing old code.
	  (do_4dpoint): new function doing special processing if message
	  originates from a 4d point.
	  (lon_first): return first entry in LON.
	  (node_eq3d): check for NULL pointer.
	  (node_eq2d): check for NULL pointer.
	  (do_4dpoint): rewritten, changing the SEEN-BY / PATH entries to
	  full 3d/4d addresses if message comes from 
	  (node_eq2d): rename to node_eq3a().
	  (node_eq3da): only ignore point field, if a->point == 0.
	  (main): added EchoMail4D config option.

	------- CVS ci -------------------------------------------------------

	* src/toss/ftntoss.c (pkts_in, pkts_bytes): new global statistics.
	  (main): addded more statistics output: number of packets, time,
	  Kbyte/s, msgs/s.
	  (unpack_file): update pkts_in, pkts_bytes for each file.

Sun Feb 16 11:27:47 1997  Martin Junius  <mj@fido.de>

	* doc/fidogate.texi (Config): added KillSplit, KillOld.

	------- CVS ci -------------------------------------------------------

	* src/common/log.c (log): use new date_buf() with own buf[] for
	  output of log date to avoid problems if a call to date() is in
	  the argument list of log().

	* src/common/date.c (date_buf): new version of old date()
	  function, new argument passing pointer to string buffer.
	  (date): wrapper around date_buf(), using static buf[] for
	  compatibility with old date().

	* src/toss/ftntoss.c (unpack): if EchoMail, parse * Origin line.

	* config.h (DATE_FTS_0001): added date() definition for FTS-0001
	  message header date string.

	* test/tc.toss1/run: added tosser run with KillOld.

	* test/tc.toss1/config: special local config with KillOld.

	* src/toss/ftntoss.c: max_history, max_sec, now_sec, exp_sec
	  variables added as in ftnexpire.c.
	  (main): retrieve MaxHistory config value.
	  (unpack_file): update now_sec, max_sec, exp_sec for every packet
	  file.
	  (do_echomail): if kill_old is set, check message date. Messages
	  older than exp_sec will be treated as dupes.

	* version.h (VERSION, PATCHLEVEL): set to version 4.2.0.

	* src/toss/ftntoss.c (main): added KillOld config option, sets
	  kill_old flag.

	* src/gate/ftn2rfc.c (main): added KillSplit config option, sets
	  kill_split flag.
	  (unpack): if kill_split is set, skip all messages with a ^ASPLIT
	  kludge. This option helps to avoid dupes generated by the
	  PKTSORT utility, which splits large messages, but put the
	  original ^AMSGID in the part 2-n.

	* examples/orodruin/config.main: added KillOld example.

	* examples/orodruin/config.gate: added KillSplit example.

Sun Feb  9 10:40:31 1997  Martin Junius  <mj@fido.de>

	======= Release 4.1.6 ================================================
	------- CVS ci, tag R416 ---------------------------------------------

	* fidogate.lsm: update.

	* README: update.

	* ANNOUNCE: update.

	------- CVS ci -------------------------------------------------------

	* src/gate/ftnin.c (main): use '\' for OS2 and MSDOS when creating
	  ftn2rfc cmd[] string.

	* test/tc.gate11/config: set UseFTNToAddress.

	* test/tc.gate11/run: new test case, netmail processed by ftn2rfc.

	------- CVS ci -------------------------------------------------------

	* version.h (PATCHLEVEL): set to 6.

	* doc/fidogate.texi (Config): added UseFTNToAddress.

	* examples/morannon/config.gate: same.

	* examples/orodruin/config.gate: added UseFTNToAddress with some
	  description. 

	* src/gate/ftn2rfc.c (unpack): if use_ftn_to_address is TRUE
	  append @addr_to.addr, else append @cf_fqdn().
	  (main): process UseFTNToAddress config option.

Sat Feb  8 10:29:35 1997  Martin Junius  <mj@fido.de>

	* src/gate/rfc2ftn.c (snd_message): use header_getcomplete() for
	  Message-ID / References to process continuation lines.

Thu Feb  6 19:41:16 1997  Martin Junius  <mj@fido.de>

	* README: added warning for using old release 3.9.7 configuration
 	  files and scripts.

Sat Jan 18 18:27:27 1997  Martin Junius  <mj@fido.de>

	* README, ANNOUNCE: updated mailing list subscribe/unsubscribe.

	* examples/README: new README for examples directory.

Sun Jan  5 11:16:09 1997  Martin Junius  <mj@fido.de>

	* scripts/maintenance/newsyslog.sh: rewrite of script, now
	  compressing old log files.

Wed Jan  1 11:19:14 1997  Martin Junius  <mj@fido.de>

	* ANNOUNCE, README: some changes.

Tue Dec 31 13:42:37 1996  Martin Junius  <mj@fido.de>

	* src/common/misc.c (str_last): return s[l].

	* scripts/nodelist/Makefile (PROGS): added nl-2routing.

	* scripts/nodelist/nl-2routing.pl: added new script contributed by
	  Andreas Braukmann <andy@AbrA.DE>, converts nodelist to hub routing.

Sun Dec 29 13:14:46 1996  Martin Junius  <mj@fido.de>

	* scripts/misc/senduu.sh: fixed senduumail.

	======= Release 4.1.5 ================================================
	------- CVS ci, tag R415 ---------------------------------------------

	* ANNOUNCE: updated.

	* README: updated.

Fri Dec 27 22:58:56 1996  Martin Junius  <mj@fido.de>

	* scripts/misc/senduu.sh: rewritten to use the ftnflo utility.

	* src/util/Makefile (install): install ftnfattach, ftnflo in LIBDIR.

	* scripts/misc/Makefile (PROGS): added senduumail.

	* scripts/misc/senduumail.sh: new script for sending single file
	  as uuencoded mail.

Thu Dec 26 16:58:24 1996  Martin Junius  <mj@fido.de>

	* fidogate.lsm: updated.

	* ANNOUNCE: updated.

	* version.h (PATCHLEVEL): set to 5.

Tue Dec 24 18:53:58 1996  Martin Junius  <mj@fido.de>

	* sendmail/mailer/ftn.m4: removed ') after FTN_MAILER_ARGSA. Damn
	  copy&paste! ;-)

	* doc/gatebau/Makefile (install): must install msgid*.html.

Sun Dec 22 10:48:09 1996  Martin Junius  <mj@fido.de>

	* test/tc.gate7/config: added to CVS repository.

	======= Release 4.1.4 ================================================
	------- CVS ci, tag R414 ---------------------------------------------

	* ANNOUNCE: updated.

	* fidogate.lsm: updated.

	------- CVS ci -------------------------------------------------------

	------- CVS ci -------------------------------------------------------

	* sendmail/cf.ORIG/: removed entire directory.

	* doc/fidogate.texi (Sendmail): added sendmail configuration section.

	* doc/gatebau/Makefile: new Makefile for doc/gatebau/
	  sub-directory, creating HTML, LaTeX, plain text documentation
	  from SGML files.

	* doc/Makefile (SUBDIRS): added gatebau sub-directory.

Sat Dec 21 00:04:34 1996  Martin Junius  <mj@fido.de>

	* doc/fidogate.texi (Example Point 2): more information based on
 	  input from Stephan Zellerhoff <stephan@poi.westfalen.de>

Fri Dec 20 09:47:56 1996  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* fidogate.lsm: updated.

	* ANNOUNCE: updated.

	* sendmail/mailer/ftn.m4 (Mftna): changed FTN_MAILER_ARGSA to only
	  set -a and -u, not the output directory.
	  (Mftno): like ftna, but also sets -O output directory (same as
	  old ftna).

	* sendmail/cf/orodruin.mc: adapted to new RedHat release.

	* sendmail/cf.ORIG/obj/: removed entire directory.

	* sendmail/*: updated with new files from RedHat 4.0 / sendmail
	  8.8.4 configuration.

Tue Dec 17 15:42:11 1996  Martin Junius  <mj@fido.de>

	* version.h (PATCHLEVEL): set to 4.

	------- CVS ci -------------------------------------------------------

	* Updated copyright and address information in all source files.

	* doc/gatebau/msgid.sgml: LinuxDoc SGML version generated by LyX.

	* doc/gatebau/msgid.lyx: new version of msgid.doc converted to LyX.

	* doc/gatebau/: added new directory for "Gatebau" standard documents.

	* doc/msgid.doc: updated address, some editorial changes.

Fri Dec  6 08:16:28 1996  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* src/gate/rfc2ftn.c (rfc_parse): if node==NULL return OK after
	  MAUS parsing.
	  (mail_receiver): call rfc_parse() with gw==FALSE for EchoMail.

	* test/tc.gate7/run: added EchoMail tests with Gateway
 	  242:4900/99.

	* test/tc.gate7/config: added local config file setting Gateway
	  address. 

	* test/tc.gate7/run: added test with X-Comment-To: ().

Tue Dec  3 21:22:34 1996  Martin Junius  <mj@fido.de>

	======= Release 4.1.3 ================================================
	------- CVS ci, tag R413 ---------------------------------------------

	* examples/morannon/config.common: same.

	* examples/orodruin/config.common: added PInbound, UUInbound.

	* fidogate.lsm: updated.

	* README: updated.

	* ANNOUNCE (Subject): updated for new release.

Mon Dec  2 20:04:10 1996  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* doc/fidogate.texi (config.h): updated, DEF_HISTORY.
	  (Config): added History.

	* examples/orodruin/config.common: added History to example.

	* src/toss/history.c (hi_init): use new cf_p_history().

	* src/toss/ftnexpire.c (do_expire): use new cf_p_history() to get
	  complete history database file name.

	* src/include/prototypes.h (BUF_EXPAND): new wrapper for
	  str_expand_name(). 

	* src/common/config.c (cf_p_history): new function retrieving
	  History value from config file (default DEF_HISTORY).

	* config.h (DEF_HISTORY): old HISTORY changed to new default
	  value. Can be overwritten with History in config file.

	* src/toss/ftnexpire.c (do_expire): use dbzagain() to initialize
	  new history database. This should solve the performance problem.

Sun Dec  1 11:29:54 1996  Martin Junius  <mj@fido.de>

	* test/tc.history/rndmsgid: script for random msgid generation.

	* src/toss/history.c (main): new -t TIME option.
	  (hi_write_t): modified low-level version of hi_write(), taking
	  additional time of entry in history database.
	  (hi_write): use new hi_write_t().
	  (main): if no msgid on command line, read from stdin.

	* test/tc.history/run: new test case for history database.

	* src/toss/history.c (main): changed printf()s to debug().

	------- CVS ci -------------------------------------------------------

	* src/common/routing.c (parse_pkt_name): added sanity check for
	  grade/type/flavor taken from packet file name. If type or flavor
	  is invalid use default -/-/Normal.

	* src/common/binkley.c (flav_to_asc): return "Normal" for unknown
	  flavor code.

	* doc/fidogate.texi (ftnpack): added -F / and appropriate
	  warning.

Sat Nov 30 14:35:27 1996  Martin Junius  <mj@fido.de>

	* src/toss/ftnpack.c (do_noarc): call bink_attach() with mode==0,
	  not trying to delete the attachment.

	------- CVS ci -------------------------------------------------------

	* src/toss/runtoss.sh: outf uses FADIR=-F/

	* src/toss/ftnpack.c (do_noarc): if -F / is specified, treat file
	  attachment in subject as complete path, don't use
	  dir_search().

	------- CVS ci -------------------------------------------------------

	* config.h (FTN_RFC_HEADERS): added "Sender" to list of recognized
	  RFC headers.

	* test/tc.gate10/run: new test case, Sender for mailing lists.

	* src/gate/rfc2ftn.c (snd_message): add Sender line, if RFC
	  headers Sender or Resent-From are present. Typically, this will
	  be the case with mailing lists.

	* scripts/run/runpoll.sh: use runtoss outf.

	* src/toss/runtoss.sh: added new toss name "outf", running the
	  tosser for the rfc2ftn outbound with file attachments.

	* src/toss/runin.sh: add $$ to ftnlock command line.

	------- CVS ci -------------------------------------------------------

	* config.h (RFC_LVL_1_HEADERS): added "Sender", "Resent-From".

	* src/common/lock.c: all debug() levels set to 7.

	* doc/fidogate.texi (ftnlock): updated.

	* src/util/ftnlock.c (usage): new option -w --wait, new optional
	  parameter id.
	  (main): implemented new option -w --wait, use new
	  lock_program_id() with optional command line parameter id. This
	  allow scripts using the ftnlock utility to write the script PID
	  to the lock file, not the PID of the called ftnlock, e.g. by
	  executing ftnlock abcd $$.

	* src/common/lock.c (lock_lockfile_id): new version of old
	  lock_lockfile() function, using new id argument. If id!=NULL,
	  this string will be put into the lockfiles, else the PID.
	  (lock_lockfile): use new lock_lockfile_id() with id==NULL.
	  (lock_program_id): new variant of lock_program(), passing new
	  arg id to lock_lockfile_id().
	  (lock_program): use lock_lockfile_id() wiht id==NULL.

Fri Nov 29 22:17:54 1996  Martin Junius  <mj@fido.de>

	* src/toss/rununpack.sh (SPOOL): fixed to use same var name as
	  runtoss.

	------- CVS ci -------------------------------------------------------

	* examples/morannon, orodruin: updated example config files.
	
	* version.h (PATCHLEVEL): set to 3.

Mon Nov 25 19:34:09 1996  Martin Junius  <mj@fido.de>

	* src/gate/ftn2rfc.c (get_from): try to parse ^AREPLYADDR as an
	  FTN address. If it is an FTN address, don't return as Internet
	  address. 

	------- CVS ci -------------------------------------------------------

	* src/toss/runout.sh (LOGDIR): use ftnconfig.

	* src/toss/runin.sh (LOGDIR): use ftnconfig.

	* src/util/ftnconfig.c (do_para): added =inbound, =pinbound,
	  =uuinbound, =outbound to fixed parameters.

	* src/toss/rununpack.sh: same.

	* src/toss/runtoss.sh (SPOOL, OUTBOUND, INBOUND, PINBOUND,
	  UUINBOUND): use ftnconfig to get values.

	* src/util/ftnconfig.c (do_para): added =libdir, =spooldir,
	  =logdir to list of fixed parameters.

	* src/common/config.c (cf_origin, cf_organzation, cf_set_outbound,
	  cf_outbound, cf_set_inbound, cf_inbound)): removed.
	  (cf_do_line): removed special treatment for Origin,
	  Organization, Inbound, Outbound parameters (are now normal
	  string parameters).

	* src/include/prototypes.h
	  (cf_set_outbound): #define'd to cf_s_outbound(). 
	  (cf_outbound): #define'd to cf_p_outbound().
	  (cf_set_inbound): #define'd to cf_s_pinbound().
	  (cf_inbound): #define'd to cf_p_pinbound().
	  (cf_origin): #define'd to cf_p_origin().
	  (cf_organization): #define'd to cf_p_organization().

	* src/common/config.c (cf_p_s_pinbound): new version of old
	  cf_p_inbound(), allowing to set pval.
	  (cf_p_pinbound): use new cf_p_s_pinbound().
	  (cf_s_pinbound): new function setting PInbound value.
	  (cf_p_s_outbound): new function get/set Outbound value.
	  (cf_p_outbound): get Outbound parameter value.
	  (cf_s_outbound): set Outbound parameter value.
	  (cf_p_organization): new function get Organization parameter value.
	  (cf_p_origin): new function get Origin parameter value.

Sun Nov 17 12:47:41 1996  Martin Junius  <mj@fido.de>

	======= Release 4.1.2 ================================================
	------- CVS ci, tag R412 ---------------------------------------------

	* fidogate.lsm: updated.

	* ANNOUNCE: updated.

	* src/gate/ftn2rfc.c (unpack): initialize cvt8=0 for NetMail.
	  (unpack_file): remove debug() message, same as log().

	* src/common/kludge.c (kludge_getn): modified version of old
	  kludge_get() with new arg first. first==TRUE gets first kludge
	  from list, first==FALSE gets next one.
	  (kludge_get): use kludge_getn() with first==TRUE.

	* src/gate/ftn2rfc.c (unpack): don't delete when calling
	  kludge_pt_intl(). 

Wed Nov 13 22:14:55 1996  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* version.h (PATCHLEVEL): set to 2.

	* src/common/message.c (msg_xlate_line): must translate '=' to
	  '=3D' if using the MIME quoted-printable encoding.
	  (msg_xlate_line): AREA_QP has priority over AREA_8BIT.

	* test/tc.8bit/run: added another test mail, body2.

Sun Nov 10 11:37:44 1996  Martin Junius  <mj@fido.de>

	* src/toss/ftntoss.c (do_echomail): changed format of dupe log()
	  messages. 

	* ANNOUNCE, fidogate.lsm: updated file size.

	======= Release 4.1.1 ================================================
	------- CVS ci, tag R411 ---------------------------------------------

	* sendmail/cf/: rebuild .cf files.

	* mksubst.pl: removed.

	* README: updated.

	* fidogate.lsm: updated.

	* ANNOUNCE: updated for release 4.1.1

Sat Nov  9 17:26:07 1996  Martin Junius  <mj@fido.de>

	* src/toss/ftnaf.c (do_mail): ignore stuff aftern "-- " line
	  (start of signature).

	* src/toss/ftnafmail.c (main): initialize filefix = FALSE.

	* src/gate/ftninpost.pl: check that FTNInSendmail and FTNInRnews
	  is specified in config.gate.

	------- CVS ci -------------------------------------------------------

	* doc/fidogate.texi (Programs): added ftnafmail.
	  (ftnafmail): new node describing new ftnafmail program.

	* src/util/pktdebug.c (main): call kludge_pt_intl() to retrieve
	  complete address information.

	* src/toss/ftntoss.c (unpack): same.

	* src/toss/ftnroute.c (do_packet): same, removed #if 0 code.

	* src/toss/ftn2ftn.c (unpack): same.

	* src/gate/ftn2rfc.c (unpack): changed call to kludge_pt_intl().

	* src/common/kludge.c (kludge_pt_intl): new arg del, only call
	  tl_delete() if del == TRUE.
	  (kludge_pt_intl): strsave() ^AINTL line before running strtok().

	* src/gate/rfc2ftn.c (sendback): added va_end().

	* src/common/textlist.c (tl_appendf): added va_end().

	* src/common/log.c (log): added call to va_end().
	  (debug): error message, no output if no_debug == TRUE. Added
	  call to va_end().

	* src/common/config.c (cf_initialize): check for real uid !=
	  effective uid (setuid installed FIDOGATE programs) and set
	  no_debug=TRUE in this case.

	* src/toss/Makefile (install): install ftnaf as normal binary,
	  ftnafmail as setuid.

	* src/toss/ftnafmail.c: new setuid wrapper for ftnaf. Used for
	  sending mail to Areafix/Filefix.

	* src/toss/ftnaf.c (main): removed -x --exec-program option,
	  security problems.
	  (run_script): removed.
	  (cmd_add): removed call to run_script().

Fri Nov  1 13:25:29 1996  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* doc/fidogate.texi (Example Point): added that EchoMail4D is
	  reqired.

	* src/toss/ftntoss.c (do_echomail): moved tl_clear() for SEEN-BY,
	  PATH after path check, so that bad messages still contain the
	  original SEEN-BYs and PATH.

	* sendmail/mailer/ftn.m4: mailer ftna runs
	      rfc2ftn -a $h -u $h -O %S/out/$h 
	  writing output packets in a separate directory. This requires
	  running the tosser afterwards because from/to addresses of the
	  packet are the same ($h).
    	
	* src/gate/ftn2rfc.c (main): use str_expand_name() for -I.

	* src/toss/ftnpack.c (main): same + use BUF_COPY3(), also for -O.

	* src/toss/ftnroute.c (main): same + use BUF_COPY3().

	* src/toss/ftntoss.c (main): use str_expand_name() for -I.

	* src/common/packet.c (pkt_outdir): use str_expand_name(), so that
	  %S/%L/%O can be used.
	  (pkt_baddir): same.

	* src/toss/runtoss.sh: added -p for "runtoss out".

	* doc/fidogate.texi (ftntoss): added -p --passthru option.

	* src/toss/ftntoss.c (usage): new -p --passthru option.
	  (main): implemented -p --passthru.
	  (do_echomail): only toss for own address if p_flag is FALSE.

	* doc/fidogate.texi (Example Point 2): new section for setup with
	  2 point addresses. Not yet complete.

	------- CVS ci -------------------------------------------------------

	* src/gate/rfc2ftn.c (rfc_parse): new argument gw, if TRUE enables
	  cf_gateway() checking and address/name replacement.
	  (mail_receiver): call rfc_parse() with gw=TRUE.
	  (mail_sender): call rfc_parse() with gw=FALSE, fixing the bug
	  that also the sender was set to UUCP when Gateway Z:N/F.P was
	  enabled in config.gate.

	* test/tc.gate9/run (Subject): new test case for "Gateway" config
	  statement. 

Mon Oct 28 22:04:56 1996  Martin Junius  <mj@fido.de>

	* test/tc.point2/run: new test case to setup with 2 different
	  point addresses and 2 different uplinks.

Sun Oct 27 13:33:33 1996  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* test/tc.8bit/run: new test case for testing char conversion
 	  quoted-printable -> rfc2ftn -> ftn2rfc ->
 	  ascii/8bit/quoted-printable.

	* src/common/charset.c (xtab[][][]): improved ISO LATIN-1 ->
	  ASCII/8BIT/QP conversion table.

	* src/toss/rununpack.sh: check that an archiver program for the
	  archiver type was found.

	* src/common/config.c (cf_p_aliases, areas, hosts, passwd,
	  packing, routing): char buf[] replaced with
	  char *pval.
	  (cf_p_inbound): new function returning config Inbound.
	  (cf_p_pinbound): new function returning config PInbound,
	  fallback is Inbound.
	  (cf_p_uuinbound): new function returning config UUInbound,
	  fallback is Inbound.

	* doc/fidogate.texi (Areas): added -Q.
	  (Config): added NetMail8bit, NetMailQuotedPrintable.
	  (Config): changed Inbound, PInbound, added UUInbound.

	* config.h (CHARSET_8BIT): removed.

Tue Oct 22 20:52:14 1996  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* src/common/rfcaddr.c (rfcaddr_from_ftn): call charset_xlate()
	  with cidx=0.

	* src/common/charset.c (charset_xlate): additional arg cidx, used
	  as index for xtab[][][].

	* src/common/message.c (msg_xlate_line): call charset_xlate() with
	  new arg cidx.

	* src/common/charset.c (xtab): extended to 3d array, left index is
	  type of conversion 0=US-ASCII, 1=ISO-8859-1 8BIT, 2=ISO-8859-1 QP.

	* src/common/message.c (msg_xlate_line): new cvt8 argument.

	* src/gate/ftn2rfc.c (news_msg): initialize all Area fields.
	  (netmail_8bit, netmail_qp): new flags for config.gate
	  "NetMail8bit", "NetMailQuotedPrintable".
	  (main): get "NetMail8bit", "NetMailQuotedPrintable" from config.gate.
	  (unpack): output MIME-Version, Content-Type,
	  Content-Transfer-Encoding headers dependend on cvt8 flag
	  settings (AREA_8BIT | AREA_QP).
	  (unpack): moved check for mail or news before message body
	  conversion (must set cvt8 before).
	  (unpack): pass cvt8 / 0 as additional parameter to msg_xlate_line().

	* src/common/areas.c (areas_init): implemented -Q option.

	* src/include/structs.h (AREA_QP): new #define for -Q option.

Sun Oct 20 10:53:14 1996  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* test/tc.gate6/run: added test with a large mail message >660K to
	  test for correct computation of number of split messages.

	* version.h (PATCHLEVEL): set to 1.

	* src/gate/rfc2ftn.c (snd_mail): initialize from_is_local = FALSE.
	  (snd_message): run same algorithm to compute number of parts as
	  done for the actual splitting.

	* src/common/address.c (addr_is_domain): moved debug() after var
	  settings. 

	* src/ffx/ffxrmail.pl: if the From_ line does not contain an
	  envelope sender, set to news@localhost.

	* doc/fidogate.texi (ftnpack): added -F --file-dir option.

	======================================================================

	* Started new ChangeLog after release of 4.1.0, old ChangeLog
	  renamed to ChangeLog.O.

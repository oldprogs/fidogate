Wed Apr 17 12:12:08 1996  Martin Junius  <mj@fido.de>

	* src/include/version.h (VERSION): fixed text for VERSION, no RCS
	  substitution.

	* CVS: due to problems with old version imported again
	  ----- FIDOGATE 4.0.0 (alpha0) -----

	* src/util/Makefile: added pktmore script.

	* src/toss/ftntoss.c (do_echomail): for messages without ^MSGID
	  use the id string "NOMSGID: Z:N/F.P YYMMDD HHMMSS abcd1234",
	  where "abcd1234" is a CRC32 over from, to, and subject. If
	  KillNoMSGID is set, messages without ^AMSGID will be treated as
	  dupes.
	  (do_echomail): include area name in MSGID key, resulting in per
	  area dupe check.

	* src/gate/ftn2rfc.c (check_origin): moved to message.c as
	  msg_parse_origin(). 
	  (unpack): call to check_origin() replaced with msg_parse_origin().

	* src/toss/ftntoss.c (main): new config option "KillDupe".
	  (main): log number of dupes if any.

	* src/toss/history.c: new module with function for MSGID history
	  database. 
	  (hi_init): initialize/open MSGID history.
	  (hi_close): close MSGID history.
	  (hi_write): write record to MSGID history.
	  (hi_test): test if MSGID is already in database.

	* src/toss/ftntoss.c (do_echomail): implemented dupe check using
	  hi_test(), hi_write().

	* src/common/xalloc.c (strsaveline): use strip_crlf().

	* src/toss/ftntoss.c (main): new config options "DupeCheck" and
	  "KillNoMSGID". 
	  (main): hi_open(), hi_close() MSGID history if DupeCheck is set.

Mon Apr  8 10:57:06 1996  Martin Junius  <mj@fido.de>

	* src/toss/ftntoss.c (main): use BUF_COPY(), BUF_COPY3().
	  (main): set pkt_baddir to O_flag if -O option is given.

	* src/common/message.c (msg_body_parse_netmail,
	  msg_body_parse_netmail): improved tear line check for either an
	  empty "---\r" tearline or a normal one starting with "--- ".

	* src/common/misc.c (strip_crlf, strip_space): return if line==NULL.

	* src/gate/ftn2rfc.c (unpack): if
	  use_origin_for_organization==TRUE, check also for body.origin!=NULL.

	* src/gate/rfc2ftn.c (main): renamed --ignore-registration to
	  --ignore-hosts. 

	* src/gate/ftn2rfc.c (main): implemented -i --ignore-hosts option.
	  (usage): new -i --ignore-hosts option.
	  (unpack): implement -i using ignore_hosts flag.

Sun Apr  7 19:08:52 1996  Martin Junius  <mj@fido.de>

	* src/toss/ftntoss.c (do_bad_msg): new function saving bad message
	  to TOSS_BAD/badxxxxx.pkt.
	  (do_echomail): if kill_unknown is FALSE, save message for
	  unknown area in TOSS_BAD.
	  (do_echomail): if kill_routed is FALSE, save routed EchoMail in
	  TOSS_BAD.
	  (do_echomail): if kill_insecure is FALSE, save insecure EchoMail
	  in TOSS_BAD.
	  (do_echomail): if kill_circular is FALSE, save EchoMail with
	  circular ^APATH in TOSS_BAD.
	  (main): new config options KillInsecure and KillCircular.
	  (main): set directory for bad packets to SPOOLDIR/TOSS_BAD.

	* src/: renamed all outpkt_open2() to outpkt_open().

	* src/common/outpkt.c (outpkt_open): removed, obsolete.

Sat Apr  6 13:26:49 1996  Martin Junius  <mj@fido.de>

	* src/gate/ftn2rfc.c (unpack): if no_messages_without_msgid is
	  set, don't gate messages without a valid MSGID (or ORIGID,
	  Message-ID, RFC-Message-ID).
	  (main): use dir_open(), dir_get(), dir_close().
	  (main): check NoUnknownMSGIDZones and NoMessagesWithoutMSGID
	  config options.
	  General changes to debug() levels.
	  (main): check UseOriginForOrganization config option.
	  (unpack): if use_origin_for_organization is set, use the text
	  from the FTN * Origin line for the Organization header (removing
	  the address part) and output no X-FTN-Origin header.

	* src/common/config.c (cf_zones_check): require zone entry != 0
	  (avoid finding default entry for zone==0).

	* src/gate/ftn2rfc.c (unpack): if no_unknown_msgid_zones is set,
	  check MSGID for known zone and don't gate messages with unknown
	  zone address in MSGID.

	* src/common/msgid.c (msgid_fido_to_rfc): return *pzone = -2, if
	  new-style converted RFC Message-ID is found.

	* src/gate/ftn2rfc.c (check_origin): use node_invalid().

	* src/common/msgid.c (msgid_fido_to_rfc): new arg pzone. If !=
	  NULL, zone value of address in MSGID will be returned via this
	  pointer. 

	* src/gate/ftn2rfc.c (unpack): put only thisdomain in Path header,
	  if thisdomain == uplinkdomain.
	  (unpack): add In-Reply-To header with reference for mail.

	* src/toss/ftnpack.c (pkttime_name): packet name for archive is
	  the same as the one generated by ftnroute.

Fri Apr  5 17:41:18 1996  Martin Junius  <mj@fido.de>

	* src/tick/ftntick.c (check_file): use dir_search().

	* src/common/dir.c (dir_search): return NULL, if opendir() fails.
	  (dir_search): use dirname arg for directory name, fixed function
	  to make it work.

	* src/toss/ftnpack.c (file_attach_dir): directory to search for
	  file attaches.
	  (usage): new option -F --file-dir.
	  (main): implemented -F --file-dir.
	  (do_noarc): new arg flonode, passing this address for file attaches.
	  (do_noarc): new file attach processing using file_attach_dir[]
	  and dir_search().

	* src/common/misc.c (str_last): new function returning last char
	  in string.
	  (str_lastp): new function returning pointer to last char in string.

	* src/common/dir.c (dir_search): new function case-insensitive
	  searching for a file in a directory. Changes passed string arg
	  to correct case, if found.

	* src/common/routing.c (parse_pkt_name): set from, to fields from args.

	* src/common/outpkt.c (outpkt_open): commented out.

	* src/toss/ftnpack.c: changed to use new PktDesc from, to fields.
	  (do_packing): dito more.

	* src/toss/ftnroute.c: changed to use new PktDesc from, to fields.
	  (do_packet): use outpkt_open2().

	* src/common/routing.c (parse_pkt_name): new arg to.

	* src/include/structs.h (PktDesc): new field from, to, replacing
	  old node field.

	* src/toss/ftnroute.c (flav_to_out): removed, obsolete.

	* src/toss/ftntoss.c (do_echomail): if -a is present in areas.bbs
	  entry, use this address as the sender.
	  (toss_echomail): use outpkt_open2().
	  (do_netmail): use outpkt_open2().
	  (do_netmail): don't put full pathname for file attach into
	  subject, path will be checked by ftnpack.

	* src/common/areasbbs.c (areasbbs_print): output -z N
	  flag. Because zone is always != -1 this has the effect of
	  rewriting all areas.bbs entries with the -z flag.

Fri Mar 29 15:04:16 1996  Martin Junius  <mj@fido.de>

	* src/toss/ftnroute.c (main): use dir_open(), dir_get(), dir_close().

	* src/toss/ftnpack.c (main): use dir_open(), dir_get(), dir_close().

	* src/tick/ftntick.c (do_tic): dir_open(,,TRUE).

	* src/ffx/ffxqt.c (do_ffx): dir_open(,,TRUE).

	* src/toss/ftntoss.c (main): dir_open(,,TRUE).

	* src/common/dir.c (dir_open): additional argument ic (TRUE=ignore
	  case) use wildmatch().

	* src/common/version.c (version_global): don't include patch level
	  in global version number (patchlevel will maintained separately).

	* src/toss/ftnroute.c (do_move): use outpkt_sequencer(),
	  outpkt_outputname(). 

	* src/common/outpkt.c (outpkt_names): only 5 hex digits.
	  (outpkt_outputname): new function creates output packet name.
	  (output_sequencer): new function returns output sequencer number.

	* src/common/wildmat.c (wildmatch): updated comment.

	* src/toss/ftnroute.c (main): match for "????????.pkt", ignoring case.

	* src/common/routing.c (parse_pkt_name): changed to support new
	  "GTFxxxxx.pkt" packet names.

	* src/common/outpkt.c (OutPkt): added field bad, TRUE=bad packet,
	  FALSE=normal packet.
	  (outpkt_new): set bad to FALSE.
	  (outpkt_names): set bad field, create name in bad packet
	  directory if bad==TRUE.
	  (outpkt_open2): new function creating tosser output
	  packet. Similar to the old function outpkt_open(), but takes
	  into account both sender and receiver FTN address. Additional
	  argument bad allows to create packets in the bad packet
	  directory.

	* src/common/packet.c (pkt_outdir): changed to use BUF_COPY(),
	  BUF_APPEND(). 
	  (pkt_baddir): new function sets bad packet directory.
	  (pkt_get_baddir): new function returns bad packet directory.

	* config.h (TOSS_BAD): toss/bad subdirectory for creating packets
	  with (forever what reason) bad messages.

	* src/common/outpkt.c (OutPkt): new fields from, to (to replaces
	  old field node).
	  (outpkt_new): new function creates OutPkt object, initializes
	  it, and puts it into the linked list.
	  (outpkt_names): new function creates tmpname ("GTFxxxxx.tmp")
	  and outname ("GTFxxxxx.pkt"). G=grade, T=type, F=flavor, xxxxx=5
	  hex digits packet sequence number.
	  (outpkt_open): function changed to use new outpkt_new(),
	  outpkt_names(), some other small changes.

Tue Mar 26 20:38:20 1996  Martin Junius  <mj@fido.de>

	* src/toss/ftntoss.c (do_echomail): check that packet from our own
	  address is not send again (point setup with Address==Uplink).
	  (do_seenby): removed j_flag code (obsoleted by new non-passthru
	  areas.bbs entries).
	  (usage): removed -j option.
	  (main): removed -j option.

	* src/gate/rfc2ftn.c (main): get EchoMail4D setting from config file.
	  (print_origin): use echomail4d flag instead of #ifdef.

	* config.h (FTN_4D_ECHOMAIL_WITH_POINTS): define removed, is now a
	  statement in config.gate.

Sun Mar 24 12:27:05 1996  Martin Junius  <mj@fido.de>

	* src/gate/rfc2ftn.c (main): switch stdin to binary for reading
	  news batches (option -b) for OS2 and MSDOS (MSDOS not
	  yet). Thanx to schaefer@calle2.ruhr.de (Christian Schaefer) for
	  reporting.

	* src/toss/ftntoss.c: if area is not marked as passthru (#DIR
	  entry in areas.bbs), toss message for our own address. Until now
	  ftntoss only did passthru areas.

	* src/include/structs.h (AreasBBS): added flags field and
	  AREASBBS_PASSTHRU define.

Sat Mar 23 17:30:10 1996  Martin Junius  <mj@fido.de>

	* ---------- FIDOGATE is now ANSI-C only !!! ----------

	* src/gate/rfc2ftn.c (sendback): removed non __STDC__ version.

	* src/ffx/, gate/, tick/, toss/, util/: converted *.c files for
          STDC function declaration.

	* src/common/xalloc.c: removed malloc(), realloc() declaration.

	* src/common/: converted *.c files for STDC function declaration.

	* src/common/log.c (log): removed non __STDC__ version.
	  (debug): removed non __STDC__ version.

	* src/common/bufstring.c (buf_sprintf): removed non __STDC__ version.

	* src/common/textlist.c (tl_appendf): removed non __STDC__ version.

	* src/include/prototypes.h: removed P() macro around function
	  prototypes.

	* src/include/fidogate.h: removed non __STDC__ and M_XENIX stuff.
	  Removed P() macro.

Fri Mar 22 22:24:09 1996  Martin Junius  <mj@fido.de>

	* src/common/msgid.c (msgid_mime_quote): char 0x7f must be
	  MIME-quoted as well.

Sun Mar 17 17:57:04 1996  Martin Junius  <mj@fido.de>

	* src/tick/ftntick.c (process_tic): add sender (TIC From) to
	  SEEN-BY list if not already there.

	* src/ffx/ffxbatch.c (ARC_PROG, ARC_PROG_V): use "/usr/bin/zip",
	  Linux standard. FIXME.

	* src/ffx/ffx.c (DATA_COMPR): use "/bin/gzip", Linux RedHat
	  2.1. FIXME: make all programs configurable in config.ffx.

Sun Mar 10 12:34:38 1996  Martin Junius  <mj@orodruin.fido.de>

	* src/ffx/ffx.c (DATA_NOCOMPR): use "/bin/cat", Linux standard.

Tue Feb 13 21:33:13 1996  Martin Junius  <mj@ipc1sbu.bbn.hp.com>

	* src/include/patchlevel.h (PATCHLEVEL): reset to 0

	* src/common/version.c (version_global): added #ifdef ALPHA for
	  alpha versions of FIDOGATE.

	* mksubst.pl: new option -c to specify config.make.

	* rules.make: changed to omit calling mksubst script.

Sun Feb 11 11:19:11 1996  Martin Junius  <mj@orodruin.fido.de>

	* src/ffxmail.sh: some changes, added orodruin.fido.de.

	* config/: new directory for sample config files (sendmail V8 for
	  now).

	* config.make (LIBDIR): changed to /usr/local/lib/fidogate
	  (SPOOLDIR): changed to /var/spool/fido
	  (LOGDIR): changed to /var/log/fido

	* ---------- Started new ChangeLog for 4.0alpha ----------

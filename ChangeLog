2000-01-28  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* *: updated copyright notice to 1990-2000.

	* version.h: version set to 4.4.0 stable.

	* src/charset/charset.map: new mappings contributed by "Mathias
	  Pannike" <st000320@hrzpub.tu-darmstadt.de>, completing missing
	  mappings -> x-ibmpc, x-mac.

1999-12-28  Martin Junius  <mj@fido.de>

	* scripts/misc/areasbbssync.pl: added ger.* to PATTERN,
	  binaer|dateien to NPATTERN.

1999-11-25  Martin Junius  <mj@fido.de>

	* scripts/www/gate.cgi.pl: using <NEWSSPOOLDIR> doesn't work
	  because it points to .../articles.

	* scripts/Makefile (SUBDIRS): must add www to SUBDIRS.

	* version.h (PATCHLEVEL): set to 7 for next release, forget to set 
	  this to 6 for release 4.3.6.

1999-11-21  Martin Junius  <mj@fido.de>

	======= Release 4.3.6 ================================================
	------- CVS tag R436 -------------------------------------------------
	------- CVS ci -------------------------------------------------------

	* examples/README: updated.

	* fidogate.lsm: updated.

	* ANNOUNCE: updated.

	* scripts/maintenance/logcheck.pl: some clean-ups, now logs
	  separately mail-abuse.org RBL, DUL, RSS rejects.

	* scripts/Makefile (install): "make install" now recurses into
	  subdirs. 

	* scripts/run/Makefile: standard "make install" installs nothing,
	  "make install-point" installs standard runpoll, "make
	  install-orodruin" the special runpoll/runpolli for orodruin.

	* sendmail/cf/: updated some example files.

	* examples/nevyn/: removed.

	* examples/morannon/: updated example files.

	* examples/orodruin/: updated example files.

1999-11-09  Martin Junius  <mj@fido.de>

	* scripts/maintenance/logcheck.pl: always show relay for RBL
	  reject summary.

1999-11-07  Martin Junius  <mj@fido.de>

	* scripts/www/gate.cgi.pl: changed to NEWSPOOLDIR/outgoing,
	  removed <SPOOLDIR>.

1999-10-20  Martin Junius  <mj@fido.de>

	* scripts/maintenance/logcheck.pl: added processing of RBL rejects.

	* sendmail/cf/mrbl.p3: sendmail config file patch required for new 
	  RBL settings in redhat6-morannon.mc

	* sendmail/cf/redhat6-morannon.mc: added RBL feature, see
	  http://www.mail-abuse.org/ 

1999-10-18  Martin Junius  <mj@fido.de>

	* scripts/maintenance/logcheck.pl: check for "ruleset=check_xxx".

1999-10-17  Martin Junius  <mj@fido.de>

	* sendmail/cf/redhat6-morannon.mc: error messages will be send to
	  postmaster-errors.

	------- CVS ci -------------------------------------------------------

	* scripts/www/gate.cgi.pl (my_ps_news): adapted to new ps output
	  of procps-2.0 package.

	* scripts/maintenance/logsendmail.p: fixed orphan printf.

	* scripts/misc/Makefile (install): install senduumail in BINDIR.

	* scripts/maintenance/logcheck.pl: re patterns adapted for
	  sendmail 8.9.x

1999-10-10  Martin Junius  <mj@fido.de>

	* Makefile (INSTALLDIRS): added BTBASEDIR/tick,ffx directories.
	  (install-uuin): added new target to set correct permissions for
	  uuin. 

1999-10-09  Martin Junius  <mj@fido.de>

	* sendmail/cf/redhat6-morannon.mc: add confDOMAIN_NAME to avoid
	  problems with reverse mapping pointing to faho.rwth-aachen.de.

1999-10-07  Martin Junius  <mj@fido.de>

	* scripts/maintenance/runchklock.sh: new script removing stale
	  FIDOGATE lock files.

	* sendmail/cf/redhat6-morannon.mc: use /etc/majordomo.aliases.

1999-10-04  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* doc/fidogate.texi (Config): updated.
	  (config.h): updated.

	* src/gate/ftn2rfc.c (main): implemented config option
	  NetMailCharsetUse1st.

	* src/common/message.c (msg_get_line_length): new function getting 
	  config value MessageLineLength.
	  (msg_format_buffer): changed to use new msg_get_line_length().

	* config.h (MAX_LINELEN): removed.

	* examples/orodruin/fidogate.conf: included
	  NetMailCharsetUse1st and MessageLineLength.

1999-09-12  Martin Junius  <mj@fido.de>

	* src/charset/Makefile (install): install charset map source, too.

	* src/gate/send-fidogate.sh (FIDOGATE_LOGFILE): log output to
	  %G/log-news. 

1999-09-05  Martin Junius  <mj@fido.de>

	* sendmail/cf/redhat6-morannon.mc: new config file for morannon
	  with RedHat 6.0 / sendmail 8.9.

1999-09-01  Martin Junius  <mj@fido.de>

	* src/common/binkley.c (bink_mkdir): log() if mkdir() fails.

1999-08-22  Martin Junius  <mj@fido.de>

	* ANNOUNCE: updated.

	* README: updated.

	* scripts/run/runpoll-binkd.sh: send mail to DUMMYADDR to force
	  polling, BinkD won't poll for empty FLO file.

1999-08-08  Martin Junius  <mj@fido.de>

	======= Release 4.3.5 ================================================
	------- CVS tag R435a ------------------------------------------------
	------- CVS ci -------------------------------------------------------

	* sendmail/mklinks (DIRS): create DIRS if needed.

	------- CVS tag R435 -------------------------------------------------
	------- CVS ci -------------------------------------------------------

	* fidogate.lsm: updated.

	* ANNOUNCE: updated.

	* test/tc.flo/run: test case adapted to new bink_attach() behaviour.

	------- CVS ci -------------------------------------------------------

	* config.make
	  (DEFAULT_F_NEWSLIBDIR): changed for INN 2.2, RedHat 6.0.
	  (DEFAULT_F_NEWSSPOOLDIR): dito.

1999-08-04  Martin Junius  <mj@fido.de>

	* src/gate/rfc2ftn.c (print_tear_line): output standard tear line, 
	  if none of the X headers can be found, added X-GateSoftware.

1999-08-01  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* test/tc.bink/run: added some tests with ftnpack.

	* src/common/binkley.c (bink_attach): pass bsy flag to flo_close()!

1999-07-23  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* src/toss/ftnpack.c (do_arcmail): call bink_attach() also for new 
	  arcmail files.

	* src/common/binkley.c (bink_attach): now searches thru FLO file
	  for file attachment. If the file attachment already is an entry
	  in the FLO it will be skipped.

1999-07-18  Martin Junius  <mj@fido.de>

	* src/common/flo.c (flo_openx): additional argument flav, needed
	  for bink_attach().
	  (flo_openx): argument renamed to apmode, if TRUE open in "a+" mode.

	* src/common/binkley.c (bink_attach): old FLO open code replaced
	  with call to new function flo_openx().
	  (bink_attach): use flo_close() as well.

	* src/common/flo.c (flo_openx): if loop is repeated, don't remove
	  BSY file.

	* test/tc.bink/run: new test case for bink_attach(), using
	  ftnfattach utility.

	* src/common/binkley.c (main): removed test main() because it was
 	  actually the intended to be the same code as ftnfattach.c:main()
 	  ;-)

	* sendmail/cf/redhat6-orodruin.mc: new orodruin configuration,
	  merging old orodruin[-check].mc and RedHat 6.0
	  /usr/lib/sendmail-cf/cf/redhat.mc.

	* sendmail/cf/Makefile: adapted to new config.

	------- CVS ci -------------------------------------------------------

	* doc/fidogate.texi (config.make): added SENDMAIL_CF_DIR.

	* sendmail/mkclean: new script, removing symlinks to
	  /usr/lib/sendmail-cf.

	* sendmail/Makefile: new Makefile for sendmail dir.

	* sendmail/mklinks (DIRS): new script, creating links to original
	  sendmail m4 config files living under /usr/lib/sendmail-cf.

	* config.make (SENDMAIL_CF_DIR): new macro setting directory,
	  where sendmail m4 configuration files are installed.

1999-07-03  Martin Junius  <mj@fido.de>

	* src/common/binkley.c (main): added test main().

	* src/common/flo.c (flo_openx): renamed old flo_open() because of
	  new argument wpmode. If wpmode is TRUE, the function will try
	  again if the access() check fails after sucessfully locking the
	  FLO file.
	  (flo_open): wrapper for flo_openx(), wpmode=FALSE.
	  (flo_file): new function returning flo_fp.

1999-06-27  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* doc/fidogate.texi (ftntickpost): new section.

	* src/tick/ftntickpost.pl: new postprocessor skeleton script for
	  ftntick. 

	* doc/fidogate.texi (ftntick): add -x --exec SCRIPT.

	* version.h (PATCHLEVEL): set to 5, version 4.3.5

	* src/tick/ftntick.c (usage): new -x --exec SCRIPT option.
	  (main): implemented -x --exec SCRIPT option.
	  (do_tic): if -x option is set, run script after sucessfully
 	  processing TIC file.

1999-06-20  Martin Junius  <mj@fido.de>

	* ANNOUNCE: updated.

	======= Release 4.3.4 ================================================
	------- CVS tag R434a ------------------------------------------------
	------- CVS ci -------------------------------------------------------

	* src/include/prototypes.h: #undef strtok(), strtok_r, may be
	  defined as inline code when compiling with -O on Linux.

	------- CVS tag R434 -------------------------------------------------
	------- CVS ci -------------------------------------------------------

	* test/tc.*: checked and updated run.verify for all cases.

	------- CVS ci -------------------------------------------------------

	* ANNOUNCE (WARNING): updated.

	* fidogate.lsm: updated.

	* examples/point/newsfeeds: example newsfeeds entry for INN 1.x

	* version.h (PATCHLEVEL): changed to 4, version 4.3.4.

	* examples/point/*: added more example files for the configuration 
	  as described in fidogate.texi.

	* doc/fidogate.texi (Config): added description of Regex1stLine.

	* examples/*/fidogate.conf: updated with regex patterns from test
	  cases. 

	* src/common/rematch.c (regex_init): removed default
	  initialization with compiled-in regex patterns.

	* src/gate/rfc2ftn.c (get_name_from_body): append 2nd line only if 
	  2nd line doesn't start with '>', '|', ':'.

1999-06-17  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* test/tc.1stline/run: new test case for 1st line pattern matching.

	* src/gate/rfc2ftn.c (get_name_from_body): concatenate 1st and 2nd 
	  non-empty line from message body for pattern matching.

	* src/common/message.c (is_blank_line): no longer static.

	* examples/point/fidogate.conf: dito.

	* examples/win32/fidogate.conf: dito.

	* examples/morannon/fidogate.conf: dito.

	* examples/orodruin/fidogate.conf: added config example.

	* src/gate/rfc2ftn.c (main): added regex_init().
	  (get_name_from_body): uses regex_match() for finding address in
	  1st line, #if 0'ed old wildmatch() code.

	* src/common/rematch.c (regex_init): new function, initializes
	  regex list and processes Regex1stLine entries from fidogate.conf
	  (str_regex_match_sub): new function, copies i'th sub-expression
	  from regex match to string buffer.

1999-06-14  Martin Junius  <mj@fido.de>

	* src/common/rematch.c (regex_new): new function, alloc/init Regex
	  struct. 
	  (regex_parse_line): new function, compiling regex pattern string.
	  (regex_do_entry): new function, putting regex into linked list.
	  (regex_match): new function, matching string against list of
	  regex patterns.
	  (regex_match_sub): new function returns regmatch_t entry for
	  last matching regex.
	  (main): test main.

	* src/common/Makefile (OBJS): added rematch.o module.
	  (testrematch): added test target.

	* src/common/rematch.c: new modules, regular expression handling
	  for FIDOGATE, using POSIX regex functions, see HAVE_POSIX_REGEX in 
	  config.h

1999-06-08  Martin Junius  <mj@fido.de>

	* src/common/strtok_r.c (strtok_r_ext): changed logic
 	  somewhat. After returning from the function, *lasts will point to
 	  the beginning of the next token, 1st non-delim character, fixing 
	  problems for the typical strtok(s,DELIM_WS), then
	  strtok(NULL,DELIM_EOL) scan.
	  (strtok_r_ext): more changes, now mostly relying on strchr() to
	  do the job.
	  Thus no longer "based" on NetBSD ... ;-)

1999-06-07  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* src/common/xstrtok.c: module removed, obsoleted by strtok_r.c

	* src/common/Makefile (OBJS): removed xstrtok.o, obsoleted by new
	  module strtok_r.o

	* src/common/strtok_r.c (strtok): reimplemented using strtok_r_ext().
	  (xstrtok): dito.
	  (strtok_r): dito.

	* src/include/prototypes.h: added strtok_r.c functions and #define's.

1999-06-01  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* src/tick/ftntick.c (move): dito.

	* src/toss/ftnroute.c (do_move): #ifndef CYGWIN32 WARNING message.

	* src/common/Makefile: add strtok_r module, teststrtok test program.

	* src/common/strtok_r.c: new module for reentrant strtok()
	  variants based on NetBSD strtok_r.c

	* src/common/mime.c (mime_deheader): bugfix for processing
	  MIME_HEADER_CODE_START/END.

	* doc/fidogate.texi: major update, all program descriptions are
	  now up-to-date.

	* examples/namib.north.de/: completely removed.

	* examples/abis.abra.de/: completely removed.

1999-05-29  Martin Junius  <mj@fido.de>

	======= Release 4.3.3 ================================================
	------- CVS tag R433 -------------------------------------------------
	------- CVS ci -------------------------------------------------------

	* ANNOUNCE: updated.

	* config.h: fixed #ifdef __sun__ for Solaris 2.x, using #ifdef
	  __svr4__. 

	* src/include/declare.h: fixed for Solaris 2.x, using #ifndef
	  __svr4__.

1999-05-24  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* doc/fidogate.texi (Programs): updated, now lists all programs
 	  from the src/ directory.
	  (Programs): updated sequence of all following nodes with the
 	  program descriptions, added nodes for new programs. The
	  individual description are not yet up-to-date.

1999-05-23  Martin Junius  <mj@fido.de>

	* doc/fidogate.texi (config.h): added HAS_POSIX_REGEX description.
	  (Routing): added description of new "RemapX" command, not yet
	  implemented.

1999-05-22  Martin Junius  <mj@fido.de>

	* config.h (HAS_SNPRINTF): set for OS2.
	  (HAS_POSIX_REGEX): new #define for support of POSIX regex
	  functions regcomp(), regexec(), regerror(), regfree(); currently 
	  only set for Linux.

	------- CVS ci -------------------------------------------------------

	* fidogate.lsm: updated.

	* ANNOUNCE: updated.

	* test/tc.*: updated run.verify for all test cases, debug() output 
	  changed due to new features.

	------- CVS ci -------------------------------------------------------

	* version.h (PATCHLEVEL): set to 3 (version 4.3.3).

	* doc/fidogate.texi (Example Point): updated.
	  (Example Point 2): updated.
	  (Example Node): updated.

	* examples/point/fidogate.conf: new example config file for point
	  configuration.

	* doc/fidogate.texi: some bugfixes.

	-------- Integrated patch-1999-05-21 into main source ----------------

	* doc/fidogate.texi (Programs): updated list of %X abbreviations.
	  (Config): Oeff! Complete update of all config options, now in
	  sync with the latest examples/orodruin/fidogate.conf.
	  (Areas): updated.
	  (Aliases): updated.
	  (Passwd): updated.
	  (Areas.bbs): updated.

	* src/gate/ftn2rfc.c: removed #ifdef AI_2, now the default.

	* src/gate/rfc2ftn.c (snd_message): set cs_in = CHARSET_STDRFC,
	  currently "iso-8859-1". Some messages are 8bit, but don't
	  contain MIME headers.
	  (snd_message): set cs_out to CHARSET_STD7BIT "us-ascii" if cs_in
	  is CHARSET_STD7BIT.

	* config.h (CHARSET_STDRFC): new #define, charset used for RFC
	  messages without MIME headers.

	* test/cf/fidogate.conf: dito.

	* examples/orodruin/fidogate.conf: added UseXHeaderForTearline.

	* config.h (AI_2): removed, now the default.

	* src/gate/rfc2ftn.c: removed #ifdef AI_2, now the default. The
	  function associated with the alias_extended flag is now part of
	  #ifdef AI_1, which is not enabled per default.

	* src/common/aliases.c: removed #ifdef AI_2, now the default.

	* src/gate/rfc2ftn.c (main): new config option
	  UseXHeaderForTearline, replacing old AI_7 patches.
	  (st_mimeinfo): added type_boundary field.
	  (get_mime): added parsing for boundary=...
	  (get_mime): added NULL pointer check for mime.type.

	* config.h (AI_7): removed, obsoleted by new UseXHeaderForTearline
	  config option.

	* src/gate/rfc2ftn.c (snd_message): MIME header output only for
	  rfc_level > 0.
	  (snd_message): added new paramter node_from to pass node_from
	  from snd_mail().
	  (snd_message): replaced ftn_from from AI_2 patches with
	  node_from, removed some #ifdef's.
	  (print_origin): new paramter node_from.
	  (print_local_msgid): new parameter node_from.
	  (sendmail_t): renamed to snd_to_cc_bcc().
	  (main): use DEFAULT_NEWSSPOOLDIR instead of fixed "/var/spool/news".
	  (print_tear_line): #ifdef PASSTHRU_ECHOMAIL removed, new config
	  flag use_x_for_tearline enables getting tearline string from
	  headers X-FTN-Tearline, X-Mailer, User-Agent, X-Newsreader.

	* src/gate/rfc2ftn.c (snd_message): added output of modified MIME
	  header lines, header_ca_rfc() won't do this anymore.

	* config.h (RFC_LVL_1_HEADERS): removed MIME headers, will be done
	  "manually" in rfc2ftn.

	* src/gate/rfc2ftn.c (snd_message): cs_out_rfc, cs_out_fsc contain
	  RFC 2045, FSC-0054 name of charset, used for Content-Type,
	  ^ACHRS, respectively.
	  (snd_message): change Content-Transfer-Encoding depending on
	  cs_out to "7BIT" or "8BIT".

	* src/charset/charset.c (charset_alias_fsc): new function, searchs
	  FSC-0054 name for charset from alias list.
	  (charset_alias_rfc): new functions, search RFC 2045 name for
	  charset from alias list.

	* src/charset/charset.map: added us-ascii -> * mappings, updated
	  comments. 

	* src/common/mime.c (mime_dequote): translate chars >= 0x80 using
	  charset_map_c().

	* src/gate/rfc2ftn.c (snd_mail): copy list of newsgroups to
	  textlist, allowing strtok() to be used in functions called by
	  snd_mail(). 
	  (get_mime): parse Content-Type header, extract MIME type and
	  charset. 
	  (snd_message): moved MIME debug() output to get_mime().
	  (get_mime): added .type_type and .type_charset to debug() output.
	  (main): call charset_init().
	  (snd_message): use s_copy() for cs_save.
	  (snd_message): convert cs_out to upper case and use for
	  ^ACHRS. Should be fixed to search for an FSC-0054 alias, because
	  it may be configured as e.g. "iso-8859-1" instead of "latin-1".

	* src/common/misc.c (strip_space): function now returns char *
	  pointer to 1st non-space character of string. This change should
	  be compatible with the old void function.

	* src/gate/rfc2ftn.c (st_mimeinfo): added fields type_type and
	  type_charset for components of Content-Type header.

	----------------------------------------------------------------------

1999-05-19  Martin Junius  <mj@fido.de>

	* examples/win32/config.make: was missing.

	* src/common/packet.c (pkt_get_hdr): when reading FSC-0039 zone
	  fields from packet header, don't use zone 0.

1999-05-18  Martin Junius  <mj@fido.de>

	======= Release 4.3.2 ================================================
	------- CVS tag R432a ------------------------------------------------
	------- CVS ci -------------------------------------------------------

	* src/charset/russian.map: removed inline comments, no longer
	  allowed, causing compilation errors.

	* cvsexp: cvs helper script for exporting FIDOGATE release.

	------- CVS tag R432 -------------------------------------------------
	------- CVS ci -------------------------------------------------------

	* fidogate.lsm: updated.

	* config.h (HAS_STRERROR): #define for OS2.

	* examples/orodruin/fidogate.conf: updated.

	* src/common/mime.c (mime_dequote): bug fix for =<LF>.

	------- CVS ci -------------------------------------------------------

	* config.h (AI_9): removed, obsoleted by code changes.

	* src/gate/rfc2ftn.c (main): added DefaultCharset/NetMailCharset
	  options.
	  (snd_message): preparation for charset mapping table, get cs_out
	  from FIDOGATE/area config, set mapping.

	* src/common/mime.c (mime_dequote): function prepared to add
	  charset mapping.

	* src/common/mime.c (mime_dequote): removed AI_9 patches.

	* src/gate/rfc2ftn.c (check_downlinks): correct calculation for #
	  of downlinks, reduce by 1 if gateway is the first entry in LON.
	  (snd_mail): cf_set_curr/zone() directly after area is found.
	  (snd_message): removed AI_9 patches, correct lsize calculations
	  for lines with MIME soft line-breaks =<LF>.

1999-05-16  Martin Junius  <mj@fido.de>

	* doc/fidogate.texi (Config files): updated.

	* src/common/packet.c (pkt_get_hdr): initialize pkt->from/to.zone
	  values with cf_defzone(), avoid 0-Zone with really old tosser
	  programs which produce only 2D packets.

1999-05-15  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* ANNOUNCE (WARNING): updated.

	* doc/fidogate.texi (config.make): updated.
	  (Integration): updated.
	  (Compiling): updated.
	  (Testing): removed old stuff.
	  (Connecting): updated.

	* config.make: removed SHELL = /bin/sh

	------- CVS ci -------------------------------------------------------

	* src/common/dir.c (dir_compare): if size or mtime are the same,
	  compare name, yielding a deterministic order in which files with 
	  the same mtime are processed.

	* src/toss/rununpack.pl (run_prog): dito.
	  (run_arc): dito.

	* src/toss/runtoss.pl (run_prog): $args[0] contains full path
	  name, using system { $fullpath } @args doesn't seem to work with 
	  ActiveState perl on Win32.

	* config.h: #undef HAS_GETTIMEOFDAY for Win32, returns wrong
	  system time (time zone). #undef NFS_SAFE_LOCK_FILES if
	  HAS_HARDLINKS is not defined, e.g. Win32.	  

	* examples/win32/*: updated, added new example files.

	* src/tick/ftntick.c (move): dito.

	* src/toss/ftnroute.c (do_move): if utime() fails (seems to happen 
	  on Win32) make this a warning.

1999-05-13  Martin Junius  <mj@fido.de>

	* doc/fidogate.texi (config.h): updated for 4.3.
	  (Installation): updated.
	  (Introduction): updated.

	* config.h (SECURE): removed, secure is now the one and only default.

	* doc/fidogate.texi (Point): removed node.

1999-05-09  Martin Junius  <mj@fido.de>

	* src/areafix/areafix.c (cmd_unlinked): use same check permissions 
	  code as for command %list, so areas without access right aren't
	  listed for %unlinked.

1999-05-04  Martin Junius  <mj@fido.de>

	* *: added patches for some minor problems when compiling with
	  Cygwin32. 

	* examples/win32/config.make: compile config file for Cygwin32
	  port, everything lives under /fidogate/...

	* src/charset/charsetc.c: added some NULL pointer checks.

1999-04-18  Martin Junius  <mj@fido.de>

	* src/common/config.c (cf_getline): don't allow inline '#'
	  comments, only lines starting with white space and a '#' are
	  treated as comments and skipped.

1999-04-10  Martin Junius  <mj@fido.de>

	* scripts/*/Makefile: make all PROGS depend on config.make and
	  config.pl

	* config.make (DEFAULT_F_IFMAILDIR): set to /usr/lib/ifcico, which 
	  is the new directory where I installed ifcico-3.0.cm.alpha-4.1
	  ( distribution default is /usr/lib/ifmail ).

1999-04-09  Martin Junius  <mj@fido.de>

	* ANNOUNCE: updated.

	* src/common/misc.c (run_system): make cmd[] as large as buffer[], 
	  may contain a long command line, e.g. from ffxqt!

1999-04-03  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* scripts/maintenance/logsendmail.pl: don't output $unaccounted,
 	  caused by from/to entries in different log files due to log file
 	  cycling.

	* test/tc.*/run.verify: diffs seems to be OK, updated all.

	* test/Makefile (all-mk-verify): added target for updating
	  run.verify for all test cases.

	* test/tc.8bit/run: output outpkt/outrfc.

	* src/*/*.c: fixed various small problems resulting from the
	  node_to_asc() replacement.

	* scripts/Makefile: dito.

	* Makefile: dito.

	* src/Makefile (test): targets verify, test are the same as check.

	* src/common/parsenode.c (str_znfp_print): must initialize s[] to
	  empty string first.

	------- CVS ci -------------------------------------------------------

	* version.h (PATCHLEVEL): set to 2 (version 4.3.2).

	* src/common/parsenode.c (znfp): renamed to s_znfp().

	* src/common/node.c (node_to_asc): removed.

	* src/*/*.c: replaced all calls to node_to_asc() with znfp1(),
	  znfp2(), znf1(), znf2().

	* src/common/parsenode.c (str_znfp_print): new function, writes
	  Z:N/F.P to s[len], based on old s_znfp_print().
	  (s_znfp_print): new function now calling str_znfp_print().
	  (znfp1): same as znfp() but returning a static buf[].
	  (znfp2): same as znfp() but returning a static buf[],
	  independent of znfp1() for printf etc.
	  (znf1): new function for output with point0=FALSE, wildcards=FALSE.

1999-03-28  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* src/toss/ftntoss.c (add_via): use DATE_VIA.

	* src/toss/ftnroute.c (add_via): use DATE_VIA.

	* src/gate/rfc2ftn.c (snd_message): use DATE_SPLIT.
	  (print_via): use DATE_VIA.

	* src/gate/ftn2rfc.c (unpack): use DATE_FROM.

	* src/common/outpkt.c (outpkt_netmail): use DATE_VIA.

	* src/common/log.c (log): use DATE_LOG.

	* src/common/bounce.c (bounce_header): use DATE_FROM.

	* config.h (DATE_FROM): new #define for date in From_ lines.
	  (DATE_LOG): new #define for date in log() messages.
	  (DATE_VIA): new #define for date in ^AVia lines.
	  (DATE_SPLIT): new #define for date in ^ASPLIT lines.

	* src/common/tick.c (tick_add_path): use DATE_TICK_PATH.

	* config.h (DATE_TICK_PATH): renamed DATE_FIDO.

	* src/common/packet.c (pkt_put_date): use DATE_FTS_0001 from
	  config.h as format string for date().

1999-03-27  Martin Junius  <mj@fido.de>

	* src/toss/rununpack.pl (arc_type): return "RAR" if it's a RAR
	  archive. 

1999-03-21  Martin Junius  <mj@fido.de>

	* test/tc.y2k/run: new test case for Y2k and date/time functions.

	* src/common/parsedate.y (main): test all date() % formats.

1999-03-20  Martin Junius  <mj@fido.de>

	* src/common/Makefile (testdate): new test program.

	* src/common/parsedate.y (main): new test main().

	======= Release 4.3.1 ================================================
	------- CVS tag R431 -------------------------------------------------
	------- CVS ci -------------------------------------------------------

	* doc/dirs.html: updated.

	* README: updated.

	* ANNOUNCE: 4.3aX changes moved to README.

	* examples/morannon/fidogate.conf: Maus*, ftp removed. Old config
	  files removed.

	* fidogate.lsm: updated.

1999-03-19  Martin Junius  <mj@fido.de>

	* src/gate/ftn2rfc.c (unpack): xfree(cs_save) must be called after 
	  creating the MIME headers. Thanx to
	  <root@neffets.isdn.cs.tu-berlin.de> for reporting this bug.

	------- CVS ci -------------------------------------------------------

	* ChangeLog*: ChangeLog.O moved to ChangeLog.OO, ChangeLog.O
	  contains now old ChangeLog entries up to version 4.3a5,
	  ChangeLog entries for version 4.3.0 and later.

	* test/cf/fidogate.conf: dito.

	* examples/orodruin/fidogate.conf: remove Maus*, ftp config.

	* src/gate/rfc2ftn.c (rfc_parse): removed maus.de code.
	  (main): removed MausGate, MausDomain config options.
	  (addr_set_mausdomain): removed.
	  (addr_set_mausgate): removed.

	* src/common/rfcaddr.c (main): call to maus_init() removed.

	* test/tc.packprog/packing: use new fidogate.conf.

	* test/tc.8bit/config*: based on new fidogate.conf.

	------- CVS ci -------------------------------------------------------

	* test/cf/common;ffx;gate;toss.conf: removed.

	* ANNOUNCE: updated.

	* test/: make verify now yields OK for all test cases.

	* test/tc.tosskill/config*: dito.

	* test/tc.tosskill/run: dito.

	* test/tc.toss6/run: dito.

	* test/tc.toss5/run: dito.

	* test/tc.toss4/run: dito.

	* test/tc.toss3/run: dito.

1999-03-17  Martin Junius  <mj@fido.de>

	* test/tc.toss2/run: dito.

	* test/tc.toss1/config*: dito.

	* test/tc.toss1/run: dito.

	* test/tc.tick/run: new fidogate.conf.

	* test/cf/fidogate.conf: commented KillOld.

	* test/tc.rununpack/run: dito.

	* test/tc.route/run: dito.

	* test/tc.route/config: new fidogate.conf.

	* src/common/config.c (cf_check_gate): #if 0'ed "no Uplink or
	  GateAddress" check, cf_i_am_a_gateway_prog() will automatically
	  copy Address to Uplink if no Uplink is specified.

	* test/tc.point2/fidogate.conf: modified test fidogate.conf for
	  point2 test case.

1999-03-16  Martin Junius  <mj@fido.de>

	* test/tc.passthru/config: dito.

	* test/tc.packprog/run: dito.

	* test/tc.outpkt/run: dito.

	* test/tc.nomsgid/run: dito.

	* test/tc.ml/run: new fidogate.conf

	* test/cf/fidogate.conf: commented NoFromLine, uncommented
	  ReplyAddrIfmailTX.

	* test/tc.gateway/run: dito.

	* test/tc.gatenode/run: dito, removed config.*.

1999-03-14  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* test/tc.gate11/config: dito.

	* test/tc.gate11/run: dito.

	* test/tc.gate10/run: dito.

	* test/tc.gate9/config.gate: dito.

	* test/tc.gate8/run: dito.

	* test/tc.gate7/run: dito.

	* test/tc.gate7/config: dito.

	* test/tc.gate6/config*: dito.

	* test/tc.gate6/run: dito.

	* test/tc.gate4/check.conf: dito.

	* test/tc.gate4/config.*: dito.

	* test/tc.gate4/run: new fidogate.conf

	* src/gate/rfc2ftn.c (snd_message): s_freeall() removed, must not
	  be called here.

	* test/tc.gate1/config*: dito.

	* test/tc.gate1/run: dito.

	* test/tc.flo/config.dos: dito.

	* test/tc.ffx/run: dito.

	* test/tc.ffx/ffxmail: dito.

	* test/tc.bounce2/config: dito.

	* test/tc.bounce/run: new fidogate.conf.

	* test/tc.boss/run: new fidogate.conf, extra config.* removed.

	* src/common/config.c (cf_set_addr): set scf_ia=1, scf_ig=0.
	  (cf_set_uplink): set scf_ir=1.
	  (cf_set_addr): also set scf_ir=0.

	* test/tc.aliases/run: dito.

	* test/tc.af3/run: dito.

	* test/tc.af2/run: dito.

	* test/tc.af/config: new fidogate.conf

1999-03-07  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* src/toss/ftntoss.c: dito.

	* src/toss/ftnroute.c (main): dito.

	* src/toss/ftn2ftn.c (do_message): dito.

	* src/ffx/ffx.c (ffx): dito.

	* src/common/rfcaddr.c (rfcaddr_from_ftn): dito.
	  (rfcaddr_from_rfc): dito.

	* src/common/packet.c (pkt_create): dito.
	  (pkt_open_node): dito.

	* src/common/misc.c (strncpy0): removed, obsoleted by str_copy().
	  (strncat0): removed, obsoleted by str_append().

	* src/common/message.c (pkt_get_body): dito.
	  (msg_format_buffer): dito.

	* src/common/binkley.c (bink_bsy_name): dito.
	  (bink_find_flo): dito.
	  (bink_find_out): dito.

	* src/common/address.c (try_pfnz): dito.
	  (inet_to_ftn): dito.

	* src/areafix/ftnafpkt.c (rename_bad): use BUF_COPY() / BUF_APPEND().

	* src/util/ftnflo.c (do_flo): dito.

	* src/toss/ftntoss.c (do_echomail): dito.

	* src/toss/ftnpack.c (arcmail_name): dito.
	  (packing_pkt_name): dito.
	  (do_arcmail): dito.
	  (do_prog): dito.

	* src/gate/rfc2ftn.c (rfc_parse): dito.
	  (snd_message): dito.

	* src/ffx/ffxqt.c (exec_ffx): dito.

	* src/ffx/ffx.c (ffx): dito.

	* src/common/tick.c (tick_send): use str_printf().

	* src/common/textlist.c (tl_appendf): added check for buf[] overflow.

	* src/common/parsenode.c (znfp_put_number): dito.

	* src/common/packet.c (pkt_newname): dito.

	* src/common/outpkt.c (outpkt_outputname): dito.

	* src/common/node.c (node_to_asc_diff): dito.
	  (node_to_pfnz): dito.

	* src/common/mail.c (mail_open): dito.

	* src/common/lock.c (lock_lockfile_nfs): dito.

	* src/common/flo.c (main): dito.

	* src/common/binkley.c (bink_out_name): dito.
	  (bink_mkdir): dito.

	* src/charset/charset.c (charset_qpen): use str_printf().

	* src/areafix/areafix.c (areafix_tlprintf): check vsprintf()
	  returned length, fatal error if buf[] overflows.

	------- CVS ci -------------------------------------------------------

	* src/include/shuffle.h: removed, obsoleted by new TmpS temporary
	  strings used throughout FIDOGATE.

	* src/common/parsenode.c (znfp_print): renamed to s_znfp_print().
	  (s_znfp_print): rewritten to use TmpS and str_copy(), str_append().

	* src/common/rfcheader.c (header_getcomplete): renamed to
	  s_header_getcomplete().
	  (s_header_getcomplete): completely rewritten to use TmpS and
	  str_copy(), str_append().

	* src/common/rfcaddr.c (rfcaddr_to_asc): renamed to s_rfcaddr_to_asc().
	  (s_rfcaddr_to_asc): got rid of SHUFFLEBUFFER, use s_printf().

	* src/common/version.c (version_global): removed #ifdef's, simply
 	  return "MAJOR.MINOR.PATCHLEVEL".
	  (version_major, minor): simply return VERSION_MAJOR, _MINOR.

	* version.h: completely changed, now 4 #define's:
	  VERSION_MAJOR		major version number
	  VERSION_MINOR		minor version number
	  PATCHLEVEL		patchlevel
	  STATE			development ./. stable
	  Current version: 4.3.1 (development)

	* src/common/version.c (version_local): changed to use BUF_COPY().

	* version.h (PATCHLEVEL): changed to 1, version 4.3.1
	  (ALPHA, BETA): removed.
	  (STATE): change to "development".

	* src/gate/rfc2ftn.c (snd_mail): more TMPS_RETURN(), fixed missing 
	  if(status) in newsgroups for loop.

	* src/gate/ftn2rfc.c (unpack): changed log() message, 

1999-03-06  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* src/util/pktdebug.c (main): call tmps_freeall().

	* src/util/ftnoutpkt.c (do_addr): use TMPS_RETURN().

	* src/toss/ftntoss.c (unpack_file): use TMPS_RETURN().
	  (unpack): dito.

	* src/toss/ftnroute.c (do_file): use TMPS_RETURN().
	  (do_packet): dito.

	* src/toss/ftnpack.c (main): calls to tmps_freeall().
	  (do_packing): use TMPS_RETURN().
	  (do_noarc): dito.
	  (do_file): dito.

	* src/toss/ftn2ftn.c (unpack): use TMPS_RETURN().
	  (main): calls to tmps_freeall().

	* src/tick/ftntick.c (do_tic): added call to tmps_freeall().
	  (process_tic): added call to tmps_freeall in for loop.

	* src/tick/ftnhatch.c (main): added call to tmps_freeall().

	------- CVS ci -------------------------------------------------------

	* src/gate/ftn2rfc.c (main): added call to tmps_freeall().
	  (unpack): use tmps_freeall(), TMPS_RETURN().

	* src/gate/rfc2ftn.c (main): added call to tmps_freeall().
	  (snd_mail): use TMPS_RETURN().

	* src/gate/ftnin.c (do_packets): dito.

	* src/ffx/ffxqt.c (do_ffx): added call to tmps_freeall() in for loop.

	* src/ffx/ffx.c (main): added call to tmps_freeall().

	* src/common/tmps.c (testf): added test function for TMPS_RETURN() 
	  macro.

1999-03-03  Martin Junius  <mj@fido.de>

	* src/common/address.c (str_printf): moved to misc.c.

	* src/areafix/pkttmpl.c (do_file): use TMPS_RETURN().

	* src/areafix/ftnafpkt.c (do_packet): use TMPS_RETURN().

	* src/areafix/pkttmpl.c (do_packet): use TMPS_RETURN().

	* src/areafix/ftnafutil.c (do_areasbbs): call tmps_freeall().

	* src/areafix/ftnafpkt.c (do_file): use TMPS_RETURN().

	* src/areafix/ftnaf.c (do_mail): use TMPS_RETURN().

	* src/include/prototypes.h (TMPS_RETURN): new macro, calls
	  tmps_freeall() and returns from function.

1999-02-28  Martin Junius  <mj@fido.de>

	* scripts/outbound/out-rm*.sh: updated.

	* scripts/outbound/out-manip.pl: removed RCS log, use <BTBASEDIR>.

	* scripts/run/runpoll-binkd.sh: add out-manip poll $BOSSNODE to
	  force binkd poll.

	* scripts/run/runpoll-orodruin.sh: must use full path for xterm,
	  setuid wrapper resets PATH.

	* scripts/run/runpoll*.sh: use $0 for exec xterm.

1999-02-21  Martin Junius  <mj@fido.de>

	* scripts/misc/areasbbssync.pl: changed -l output to be suitable
	  for text listing.

1999-02-07  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* scripts/maintenance/logsendmail.pl: new version with many bug
	  fixes, new stats, and improved output.

1999-02-04  Martin Junius  <mj@fido.de>

	* scripts/maintenance/logsendmail.pl: don't depend on $HOSTNAME
	  for parsing syslog line. Major changes, Perl5'ified. Added
	  counter for bounced messages, bounced messages are no longer
	  included in traffic matrix.

1999-01-30  Martin Junius  <mj@fido.de>

	* scripts/maintenance/logdaily.sh: run logstat for log files
	  log-in, log-mail, log-news.

1999-01-16  Martin Junius  <mj@fido.de>

	* examples/morannon/fidogate.conf: new example single
	  configuration with setting for morannon.fido.de (gateway and
	  large hub).

	* scripts/run/runpoll-binkd.sh: modified version of
	  runpoll-orodruin.sh using binkd for polling boss node.

1999-01-10  Martin Junius  <mj@fido.de>

	======= Release 4.3.0 ================================================
	------- CVS tag R430 -------------------------------------------------
	------- CVS ci -------------------------------------------------------

	* fidogate.lsm: updated.

	* ANNOUNCE: updated.

	* README: updated.

	* src/common/log.c (log): save errno before trying to open log
	  file and restore afterwards.

	------- CVS ci -------------------------------------------------------

	* config.make (DEFAULT_F_CONFIG_xxx): switch to new single config
	  file "fidogate.conf".

1999-01-09  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* test/tc.gate5/run: same as tc.gate3

	* test/tc.gate3/run: use new fidogate.conf, added pktdebug output
	  of all created packets.

	* test/tc.gate2/run: use new fidogate.conf, added output of all
	  created RFC messages.

	* test/tc.newcf/run: new test case for checking configuration with 
	  single config file fidogate.conf.

	* examples/orodruin/fidogate.conf: example of new single
	  configuration file.

	* src/toss/ftntoss.c (main): config option "EchoMail4D" renamed to 
	  "TossEchoMail4D" to avoid conflicts with gateway "EchoMail4D"
	  configuration. 

	* config.make (DEFAULT_F_CONFIG_xxx): added new macro defs with
	  single config file fidogate.conf, commented for the time being.

1999-01-02  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* src/common/node.c (node_to_pfnz): modified to use static buf[]
	  for returning string.
	  (node_to_asc_diff): dito.

	* src/gate/rfc2ftn.c (snd_message): use new s_msgid_rfc_to_fido(), 
	  call s_freeall() at end of function.

	* src/gate/ftn2rfc.c (unpack): use new s_msgid_xxx() functions.

	* src/common/msgid.c (msgid_rfc_to_origid): removed, no longer needed.
	  (s_msgid_fido_to_rfc): converted shuffle.h stuff to TmpS.
	  (s_msgid_default): renamed to s_, converted shuffle.h stuff to TmpS.
	  (s_msgid_convert_origid): dito.
	  (s_msgid_rfc_to_fido): dito.
	  (msgid_domain): improved to only skip 1st char of domain name if 
	  it really is a ".".

	* src/gate/rfc2ftn.c (snd_message): removed #ifdef MSGID_ORIGID code.

	* config.h (MSGID_ORIGID): #define removed.

	* src/common/msgid.c (s_msgid_fido_to_rfc): renamed to s_, now
	  returns TmpS.

	* src/gate/ftn2rfc.c (unpack): use new s_ftn_to_inet().

	* src/common/rfcaddr.c (rfcaddr_from_ftn): use new str_ftn_to_inet().

	* src/common/address.c (s_ftn_to_inet): TmpS wrapper for
	  str_ftn_to_inet(). 
	  (str_printf): new replacement for sprintf(), uses vsnprintf() if 
	  available or terminates with fatal() error if buffer overflows.
	  (str_ftn_to_inet): renamed version of old ftn_to_inet()
	  function writing to str buffer.
	  (verify_host_flag): removed SHUFFLEBUFFERS.

	* src/common/config.c (cf_i_am_a_gateway_prog): if neither
	  GateAddress nor Uplink is used, copy Address to Uplink (same
	  address for gateway and tosser).

	* *: Copyright comments extended to year 1999.

	* version.h: commented ALPHA, making this the new version
	  4.3.0. From now on, 4.3.x will be the development versions, 4.4.x
	  the future new stable versions.

	* src/areafix/areafix.c (cmd_help): added log() if helpfile can't
	  be opened of AreaFixHelp is not defined.

1998-12-13  Martin Junius  <mj@fido.de>

	* sendmail/cf/morannon-check.mc: added confCOPY_ERRORS_TO.

1998-11-28  Martin Junius  <mj@fido.de>

	* scripts/run/runpoll.sh: modified (old) runpoll for generic point 
	  excluding ffx programs.

	* scripts/run/runpoll-orodruin.sh: new (old) runpoll including ffx 
	  programs.

1998-11-23  Martin Junius  <mj@fido.de>

	* src/toss/rununpack.pl (run_arc): removed extra "su" from regex.

1998-11-15  Martin Junius  <mj@fido.de>

	* examples/morannon/*.conf: updated.

	* scripts/www/gate.cgi.pl (my_ps_news): some cosmetic changes.

	------- CVS ci -------------------------------------------------------

	* scripts/www/gate.cgi.pl: new CGI script displaying gateway
	  status, who, last, processes, news and FIDOATE directories.

	* scripts/www/: new directory for CGI scripts to be used with FIDOGATE.

	* rules.make (%.cgi): added rule for .cgi.pl -> .cgi

	* subst.pl: Perl5'ified, added -o OPTS options to #!PERL line.

	* config.make (HTMLLOGDIR): directory for installing CGI scripts.

1998-11-14  Martin Junius  <mj@fido.de>

	* scripts/misc/afmail.pl, areamgr.pl: removed.

1998-11-08  Martin Junius  <mj@fido.de>

	------- CVS ci -------------------------------------------------------

	* scripts/maintenance/rc.fidogate.sh: adapted to new FIDOGATE dir
	  hierarchy.

	* scripts/maintenance/newsyslog.sh: removed (dito).

	* scripts/maintenance/logmaint.sh: removed (replaced with
	  logrotate configuration).

	* scripts/maintenance/logdaily.sh: added logstat, logreport.

	* src/toss/runtoss.pl: use grade "o" for tossing "outpkt".

	* scripts/maintenance/fidogate.logrotate: example logrotate
	  configuration for new FIDOGATE log files (run* scripts).

	* src/gate/rungate.sh: don't use non-standard log file "log-gate".

	* src/ffx/runffx.sh: add "orodruin" argument to send-ffx, use %B
	  for Binkley base dir.

	* src/gate/send-fidogate.sh: new script interface to INN.

	* src/ffx/send-ffx.sh: new script interface to INN, using new
	  ffxnews. 

	* src/ffx/ffxnews.sh: new script replacing old viaffx script.

1998-11-04  Martin Junius  <mj@fido.de>

	* src/ffx/runffx.sh: new cron script for running ffx sub-system.

	* src/toss/runin.sh: added ftntick.

	* src/gate/rungate.sh: new cron script for running gateway progs.
